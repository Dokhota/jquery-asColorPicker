/*! colorInput - v0.1.0 - 2013-10-29
* https://github.com/amazingSurge/jquery-colorInput
* Copyright (c) 2013 amazingSurge; Licensed GPL */
(function(t,o,e,i,s){"use strict";function a(t){t.id=h,h++}function n(){}var h=0,r=!!/msie/i.exec(t.navigator.userAgent);t.localStorage||(t.localStorage=n);var c=e.colorInput=function(t,o){this.input=t,this.$input=e(t),this.opened=!1,this.enabled=!0,this.isFirstOpen=!0;var s=[];if(e.each(this.$input.data(),function(t,o){var e=RegExp("^color","i");e.test(t)&&(s[t.toLowerCase().replace(e,"")]=o)}),a(this),this.options=e.extend(!0,{},c.defaults,o,s),this.namespace=this.options.namespace,this.classes={skin:this.namespace+"_"+this.options.skin,show:this.namespace+"_show"},this.components=e.extend(!0,{},this.components),this.options.localStorage){var n="input_"+this.id,h=this.getLocalItem(n);h&&(this.input.value=h)}var r=c.skins[this.options.skin]||"saturation,hue";this._comps=r.split(","),this.color=""===this.input.value?new i({r:255,g:255,b:255,a:1},this.options.format):new i(this.input.value,this.options.format),this.options.showInput===!1?this.$input.css({display:"none"}):this.options.format?this.$input.val(this.get(this.options.format)):this.$input.val(""+this.color),this.originalColor=this.color.toRGBA(),this.init()};c.prototype={constructor:c,components:{},init:function(){var t=this;this.$picker=e('<div draggable=false style="display:none;" class="'+this.namespace+' drag-disable"></div>'),this.$input.addClass("colorInput-input"),this.options.skin&&this.$picker.addClass(this.classes.skin),this.options.flat===!0?(this.create(),this.$input.addClass("colorInput-flat").css({display:"none"}),this.$picker.addClass("colorInput-flat").insertAfter(this.$input).css({display:"block",position:"relative",top:0,left:0}),this.show()):(this.components.trigger.init(this),this.create(),this.$picker.appendTo("body"),this.$input.on({"focus.colorInput":function(){t.show()},"keydown.colorInput":function(o){9===o.keyCode?t.hide():13===o.keyCode&&(t.color.from(t.$input.val()),t.update({},"input"),t.hide())},"keyup.colorInput":function(){t.color.from(t.$input.val()),t.update({},"input")}})),this.$picker.trigger("colorInput::init",this),"function"===e.type(this.options.onInit)&&this.options.onInit(this),this.$picker.trigger("colorInput::ready",this),"function"===e.type(this.options.onReady)&&this.options.onReady(this)},create:function(){var t=this;e.each(this._comps,function(o,e){t.components[e]&&t.components[e].init(t)}),this.$picker.trigger("colorInput::create")},bindEvent:function(){var i=this;e(o).on("mousedown.colorInput",function(t){return e(t.target).is(i.$input)?s:(i.options.hideFireChange===!1?i.cancel():i.apply(),!1)}),e(t).on("resize.colorInput",e.proxy(this.position,this))},unbindEvent:function(){e(o).off("mousedown.colorInput"),e(t).off("resize.colorInput")},update:function(t,o){var i=this;if(t!=={}&&i.color.set(t),this.$picker.trigger("colorInput::change",this),"function"===e.type(this.options.onChange)&&this.options.onChange(this),e.each(this._comps,function(t,e){o!==e&&i.components[e]&&i.components[e].update&&i.components[e].update(i)}),this.options.flat!==!0&&this.components.trigger.update(this),"input"!==o&&(i.options.format?i.$input.val(i.get(i.options.format)):i.$input.val(""+i.color),i.options.localStorage)){var s="input_"+this.id;i.setLocalItem(s,i.$input.val())}},opacity:function(t){return t?(this.update({a:t}),s):this.color.value.a},position:function(){var o,i,s=!this.$input.is(":visible"),a=s?this.$trigger.offset():this.$input.offset(),n=s?this.$trigger.outerHeight():this.$input.outerHeight(),h=s?this.$trigger.outerWidth():this.$input.outerWidth()+this.$trigger.outerWidth(),r=this.$picker.outerWidth(!0),c=this.$picker.outerHeight(!0);o=c+a.top>e(t).height()+e(t).scrollTop()?a.top-c:a.top+n,i=r+a.left>e(t).width()+e(t).scrollLeft()?a.left-r+h:a.left,this.$picker.css({position:"absolute",top:o,left:i})},makeUnselectable:function(){e("body").addClass("unselectable"),r&&this.$picker.find("*:not(input)").attr("unselectable","on")},cancelUnselectable:function(){e("body").removeClass("unselectable"),r&&this.$picker.find("*:not(input)").removeAttr("unselectable")},setLocalItem:function(t,o){var e=this.namespace+"_"+t,i=JSON.stringify(o);localStorage[e]=i},getLocalItem:function(t){var o=this.namespace+"_"+t,e=localStorage[o];return e?JSON.parse(e):e},show:function(){this.enabled!==!1&&(this.$picker.on("mousedown",function(t){t.stopPropagation()}),this.options.flat===!1&&(this.position(),this.$picker.css({display:"block"}),this.bindEvent()),this.$picker.addClass(this.classes.show),this.opened=!0,this.$picker.trigger("colorInput::show",this),"function"===e.type(this.options.onChange)&&this.options.onShow(this),this.isFirstOpen=!1)},close:function(){this.options.flat!==!0&&(this.unbindEvent(),this.$picker.css({display:"none"}),this.$input.blur(),this.$picker.removeClass(this.classes.show),this.$picker.trigger("colorInput::close",this),"function"===e.type(this.options.onChange)&&this.options.onClose(this))},cancel:function(){this.color.from(this.originalColor),this.update({}),this.close()},apply:function(){this.originalColor=this.color.toRGBA(),this.close(),this.$picker.trigger("colorInput::apply",this),"function"===e.type(this.options.onApply)&&this.options.onApply(this)},set:function(t){return this.color.from(t),this.update(),this},get:function(t){return t===s?""+this.color:"rgb"===t?this.color.toRGB():"rgba"===t?this.color.toRGBA():"hsl"===t?this.color.toHSL():"hsla"===t?this.color.toHSLA():"hex"===t?this.color.toHEX():s},enable:function(){return this.enabled=!0,this.$parent.addClass(this.namespace+"enabled"),this},disable:function(){return this.enabled=!1,this.$parent.removeClass(this.namespace+"enabled"),this},destroy:function(){}},c.registerComponent=function(t,o){c.prototype.components[t]=o},c.localization=[],c.defaults={namespace:"colorInput",readonly:!1,skin:null,flat:!1,showInput:!1,localStorage:!0,hideFireChange:!0,keyboard:!1,onlyBtn:!1,format:"rgb",components:{check:{applyText:"apply",cancelText:"cancel"}},onInit:function(){},onReady:function(){},onChange:function(){},onClose:function(){},onShow:function(){},onApply:function(){}},c.skins={flatSpirit:"saturation,Hhue,Halpha,hex,preview,palettes,check",realWorld:"saturation,hue,alpha,hex,preview,check"},c.registerComponent("trigger",{template:'<div class="colorInput-trigger"><span></span></div>',init:function(t){t.$trigger=e(this.template),this.$trigger_inner=t.$trigger.children("span"),null!==t.options.skin&&t.$trigger.addClass(t.classes.skin),t.$trigger.insertAfter(t.$input),t.$trigger.on("click",e.proxy(t.show,t)),this.update(t)},update:function(t){this.$trigger_inner.css("backgroundColor",t.color.toRGBA())},destroy:function(t){t.$trigger.remove()}}),e.fn.colorInput=function(t){if("string"==typeof t){var o=t,i=arguments.length>1?Array.prototype.slice.call(arguments,1):s;return this.each(function(){var t=e.data(this,"colorInput");"function"==typeof t[o]&&t[o].apply(t,i)})}return this.each(function(){e.data(this,"colorInput")||e.data(this,"colorInput",new c(this,t))})}})(window,document,jQuery,function(){return void 0===$.colorValue?!1:$.colorValue}()),function(t,o,e){var i=e(o),s={keys:{UP:38,DOWN:40,LEFT:37,RIGHT:39,RETURN:13,ESCAPE:27,BACKSPACE:8,SPACE:32},map:{},bound:!1,press:function(t){var o=t.keyCode||t.which;return o in s.map&&"function"==typeof s.map[o]&&s.map[o](t),!1},attach:function(t){var o,e;for(o in t)t.hasOwnProperty(o)&&(e=o.toUpperCase(),e in s.keys?s.map[s.keys[e]]=t[o]:s.map[e]=t[o]);s.bound||(s.bound=!0,i.bind("keydown",s.press))},detach:function(){s.bound=!1,s.map={},i.unbind("keydown",s.press)}};i.on("colorInput::init",function(t,o){o.options.keyboard===!0&&(o._keyboard=s)})}(window,document,jQuery),$.colorInput.registerComponent("Halpha",{selector:".colorInput-alpha",template:'<div class="colorInput-alpha drag-disable"><i class="drag-disable"></i></div>',width:150,data:{},init:function(t){var o=this;this.$alpha=$(this.template).appendTo(t.$picker),this.$handle=this.$alpha.children("i"),this.$alpha.on("mousedown.colorinput",function(e){var i=e.which?3==e.which:2==e.button;return i?!1:($.proxy(o.mousedown,o)(t,e),void 0)}),$(document).on("colorInput::ready",function(){o.width=o.$alpha.width(),o.step=o.width/100,o.update(t),o.keyboard(t)})},mousedown:function(t,o){var e=this.$alpha.offset();return this.data.startX=o.pageX,this.data.left=o.pageX-e.left,this.move(t,this.data.left),t.makeUnselectable(),this.mousemove=function(o){var e=this.data.left+(o.pageX||this.data.startX)-this.data.startX;return this.move(t,e),!1},this.mouseup=function(){return $(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),this.data.left=this.data.cach,t.cancelUnselectable(),!1},$(document).on({mousemove:$.proxy(this.mousemove,this),mouseup:$.proxy(this.mouseup,this)}),!1},move:function(t,o,e,i){o=Math.max(0,Math.min(this.width,o)),this.data.cach=o,e===void 0&&(e=1-o/this.width),e=Math.max(0,Math.min(1,e)),this.$handle.css({left:o}),i!==!1&&t.update({a:Math.round(100*e)/100},"Halpha")},moveLeft:function(t){var o=this.step,e=this.data;e.left=e.left-o,e.left=Math.max(0,Math.min(this.width,e.left)),this.move(t,e.left)},moveRight:function(t){var o=this.step,e=this.data;e.left=e.left+o,e.left=Math.max(0,Math.min(this.width,e.left)),this.move(t,e.left)},keyboard:function(t){var o,e=this;return t._keyboard?(o=$.extend(!0,{},t._keyboard),this.$alpha.attr("tabindex","0").on("focus",function(){return o.attach({left:function(){e.moveLeft.call(e,t)},right:function(){e.moveRight.call(e,t)}}),!1}).on("blur",function(){o.detach()}),void 0):!1},update:function(t){var o=this.width*(1-t.color.value.a);this.$alpha.css("backgroundColor",t.color.toHEX()),this.move(t,o,t.color.value.a,!1)},destroy:function(){$(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}}),$.colorInput.registerComponent("Hhue",{selector:".colorInput-picker-hue",template:'<div class="colorInput-hue drag-disable"><i class="drag-disable"></i></div>',width:150,data:{},init:function(t){var o=this;this.$hue=$(this.template).appendTo(t.$picker),this.$handle=this.$hue.children("i"),this.$hue.on("mousedown.colorInput",function(e){var i=e.which?3==e.which:2==e.button;return i?!1:($.proxy(o.mousedown,o)(t,e),void 0)}),$(document).on("colorInput::ready",function(){o.width=o.$hue.width(),o.step=o.width/360,o.update(t),o.keyboard(t)})},mousedown:function(t,o){var e=this.$hue.offset();return this.data.startX=o.pageX,this.data.left=o.pageX-e.left,this.move(t,this.data.left),t.makeUnselectable(),this.mousemove=function(o){var e=this.data.left+(o.pageX||this.data.startX)-this.data.startX;return this.move(t,e),!1},this.mouseup=function(){return $(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),this.data.left=this.data.cach,t.cancelUnselectable(),!1},$(document).on({mousemove:$.proxy(this.mousemove,this),mouseup:$.proxy(this.mouseup,this)}),!1},move:function(t,o,e,i){o=Math.max(0,Math.min(this.width,o)),this.data.cach=o,e===void 0&&(e=360*(1-o/this.width)),e=Math.max(0,Math.min(360,e)),this.$handle.css({left:o,background:$.colorValue.HSVtoHEX({h:e,s:1,v:1})}),i!==!1&&t.update({h:e},"Hhue")},moveLeft:function(t){var o=this.step,e=this.data;e.left=e.left-o,e.left=Math.max(0,Math.min(this.width,e.left)),this.move(t,e.left)},moveRight:function(t){var o=this.step,e=this.data;e.left=e.left+o,e.left=Math.max(0,Math.min(this.width,e.left)),this.move(t,e.left)},keyboard:function(t){var o,e=this;return t._keyboard?(o=$.extend(!0,{},t._keyboard),this.$hue.attr("tabindex","0").on("focus",function(){return o.attach({left:function(){e.moveLeft.call(e,t)},right:function(){e.moveRight.call(e,t)}}),!1}).on("blur",function(){o.detach()}),void 0):!1},update:function(t){var o=0===t.color.value.h?0:this.width*(1-t.color.value.h/360);this.move(t,o,t.color.value.h,!1)},destroy:function(){$(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}}),$.colorInput.registerComponent("alpha",{selector:".colorInput-alpha",template:'<div class="colorInput-alpha drag-disable"><i class="drag-disable"></i></div>',height:150,data:{},init:function(t){var o=this;this.$alpha=$(this.template).appendTo(t.$picker),this.$handle=this.$alpha.children("i"),this.height=this.$alpha.height(),this.$alpha.on("mousedown.colorinput",function(e){var i=e.which?3==e.which:2==e.button;return i?!1:($.proxy(o.mousedown,o)(t,e),void 0)}),$(document).on("colorInput::ready",function(){o.height=o.$alpha.height(),o.step=o.height/100,o.update(t),o.keyboard(t)})},mousedown:function(t,o){var e=this.$alpha.offset();return this.data.startY=o.pageY,this.data.top=o.pageY-e.top,this.move(t,this.data.top),t.makeUnselectable(),this.mousemove=function(o){var e=this.data.top+(o.pageY||this.data.startY)-this.data.startY;return this.move(t,e),!1},this.mouseup=function(){return $(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),this.data.top=this.data.cach,t.cancelUnselectable(),!1},$(document).on({mousemove:$.proxy(this.mousemove,this),mouseup:$.proxy(this.mouseup,this)}),!1},move:function(t,o,e,i){o=Math.max(0,Math.min(this.height,o)),this.data.cach=o,e===void 0&&(e=1-o/this.height),e=Math.max(0,Math.min(1,e)),this.$handle.css({top:o}),i!==!1&&t.update({a:Math.round(100*e)/100},"alpha")},moveUp:function(t){var o=this.step,e=this.data;e.top=e.top-o,e.top=Math.max(0,Math.min(this.width,e.top)),this.move(t,e.top)},moveDown:function(t){var o=this.step,e=this.data;e.top=e.top+o,e.top=Math.max(0,Math.min(this.width,e.top)),this.move(t,e.top)},keyboard:function(t){var o,e=this;return t._keyboard?(o=$.extend(!0,{},t._keyboard),this.$alpha.attr("tabindex","0").on("focus",function(){return o.attach({up:function(){e.moveUp.call(e,t)},down:function(){e.moveDown.call(e,t)}}),!1}).on("blur",function(){o.detach()}),void 0):!1},update:function(t){var o=this.height*(1-t.color.value.a);this.$alpha.css("backgroundColor",t.color.toHEX()),this.move(t,o,t.color.value.a,!1)},destroy:function(){$(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}}),$.colorInput.registerComponent("check",{selector:".colorInput-check",template:'<div class="colorInput-check drag-disable"><a class="colorInput-check-apply drag-disable"></a><a class="colorInput-check-cancel drag-disable"></a></div>',init:function(t){var o=$.extend(this.defaults,t.options.components.check);this.$check=$(this.template).appendTo(t.$picker),this.$apply=this.$check.find(".colorInput-check-apply").text(o.applyText),this.$cancel=this.$check.find(".colorInput-check-cancel").text(o.cancelText),this.$apply.on("click",$.proxy(t.apply,t)),this.$cancel.on("click",$.proxy(t.cancel,t))}}),$.colorInput.registerComponent("hex",{selector:".colorInput-hex",template:'<input type="text" class="colorInput-hex" />',init:function(t){this.$hex=$(this.template).appendTo(t.$picker),this.$hex.on("change",function(){t.set(this.value)}),this.update(t)},update:function(t){this.$hex.val(t.color.toHEX())}}),$.colorInput.registerComponent("hue",{selector:".colorInput-picker-hue",template:'<div class="colorInput-hue drag-disable"><i clsss="drag-disable"></i></div>',height:150,data:{},init:function(t){var o=this;this.$hue=$(this.template).appendTo(t.$picker),this.$handle=this.$hue.children("i"),this.height=this.$hue.height(),this.$hue.on("mousedown.colorInput",function(e){var i=e.which?3==e.which:2==e.button;return i?!1:($.proxy(o.mousedown,o)(t,e),void 0)}),t.$picker.on("colorInput::ready",function(){o.height=o.$hue.height(),o.step=o.height/360,o.update(t),o.keyboard(t)})},mousedown:function(t,o){var e=this.$hue.offset();return this.data.startY=o.pageY,this.data.top=o.pageY-e.top,this.move(t,this.data.top),t.makeUnselectable(),this.mousemove=function(o){var e=this.data.top+(o.pageY||this.data.startY)-this.data.startY;return this.move(t,e),!1},this.mouseup=function(){return $(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),this.data.top=this.data.cach,t.cancelUnselectable(),!1},$(document).on({mousemove:$.proxy(this.mousemove,this),mouseup:$.proxy(this.mouseup,this)}),!1},move:function(t,o,e,i){o=Math.max(0,Math.min(this.height,o)),this.data.cach=o,e===void 0&&(e=360*(1-o/this.height)),e=Math.max(0,Math.min(360,e)),this.$handle.css({top:o}),i!==!1&&t.update({h:e},"hue")},moveUp:function(t){var o=this.step,e=this.data;e.top=e.top-o,e.top=Math.max(0,Math.min(this.width,e.top)),this.move(t,e.top)},moveDown:function(t){var o=this.step,e=this.data;e.top=e.top+o,e.top=Math.max(0,Math.min(this.width,e.top)),this.move(t,e.top)},update:function(t){var o=0===t.color.value.h?0:this.height*(1-t.color.value.h/360);this.move(t,o,t.color.value.h,!1)},keyboard:function(t){var o,e=this;return t._keyboard?(o=$.extend(!0,{},t._keyboard),this.$hue.attr("tabindex","0").on("focus",function(){return o.attach({up:function(){e.moveUp.call(e,t)},down:function(){e.moveDown.call(e,t)}}),!1}).on("blur",function(){o.detach()}),void 0):!1},destroy:function(){$(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}}),$.colorInput.registerComponent("info",{selector:".colorInput-info",template:'<ul class="colorInput-info"><li><label>R:<input type="text" data-type="r"/></label></li><li><label>G:<input type="text" data-type="g"/></label></li><li><label>B:<input type="text" data-type="b"/></label></li><li><label>A:<input type="text" data-type="a"/></label></li></ul>',color:["white","black","transparent"],init:function(t){this.$info=$(this.template).appendTo(t.$picker),this.$r=this.$info.find('[data-type="r"]'),this.$g=this.$info.find('[data-type="g"]'),this.$b=this.$info.find('[data-type="b"]'),this.$a=this.$info.find('[data-type="a"]'),this.$info.delegate("input","keyup update change",function(o){var e,i=$(o.target).data("type");switch(i){case"r":case"g":case"b":e=parseInt(this.value,10),e>255?e=255:0>e&&(e=0);break;case"a":e=parseFloat(this.value,10),e>1?e=1:0>e&&(e=0)}isNaN(e)&&(e=0);var s={};s[i]=e,t.value(s)}),this.update(t)},update:function(t){this.$r.val(t.color.value.r),this.$g.val(t.color.value.g),this.$b.val(t.color.value.b),this.$a.val(t.color.value.a)}}),$.colorInput.registerComponent("palettes",{selector:".colorInput-palettes",template:'<div class="colorInput-palettes"></div>',height:150,palettes:{defines:[""],colors:["#fff","#000","#000","#ccc"],max:6},init:function(t){var o="<ul>",e=this,i=$.extend(!0,{},this.palettes,t.options.components.palettes);if(this.keyboardBinded=!1,t.options.localStorage){var s="palettes_"+t.id,a=t.getLocalItem(s);a&&(i.colors=a)}$.each(i.colors,function(t,e){o+='<li style="background-color:'+e+'" data-color="'+e+'">'+e+"</li>"}),o+="</ul>",this.$list=$(o),this.$palettes=$(this.template).append(this.$list).appendTo(t.$picker),this.$palettes.delegate("li","click",function(o){var i=$(o.target).data("color");e.$list.find("li").removeClass("colorInput-palettes-checked"),$(o.target).addClass("colorInput-palettes-checked"),t.set(i),t.close()}),this.$palettes.attr("tabindex","0").on("blur",function(){e.$list.find("li").removeClass("colorInput-palettes-checked")}),t.$picker.on("colorInput::apply",function(t,o){-1===i.colors.indexOf(o.originalColor)&&(i.colors.length>=i.max&&(i.colors.shift(),e.$list.find("li").eq(0).remove()),i.colors.push(o.originalColor),e.$list.append('<li style="background-color:'+o.originalColor+'" data-color="'+o.originalColor+'">'+o.originalColor+"</li>"),o.options.localStorage&&o.setLocalItem(s,i.colors))}),$(document).on("colorInput::ready",function(){return e.keyboard(t),!1})},keyboard:function(t){var o,e,i,s=this;return t._keyboard?(o=$.extend(!0,{},t._keyboard),this.$palettes.attr("tabindex","0").on("blur",function(){o.detach(),s.keyboardBinded=!1}),this.$palettes.attr("tabindex","0").on("focus",function(){function a(t){h.removeClass("colorInput-palettes-checked"),h.eq(t).addClass("colorInput-palettes-checked")}function n(){return h.index(s.$palettes.find(".colorInput-palettes-checked"))}if(s.keyboardBinded!==!0){var h=s.$list.find("li");e=-1,i=h.length,o.attach({left:function(){var t=n();-1===t?e-=1:e=t-1,0>e&&(e=i-1),a(e)},right:function(){var t=n();-1===t?e+=1:e=t+1,e>=i&&(e=0),a(e)},RETURN:function(){if(!(0>e)){var o=h.eq(e).data("color");t.set(o),t.close()}}}),s.keyboardBinded=!0}}),void 0):!1}}),$.colorInput.registerComponent("preview",{selector:".colorInput-preview",template:'<div class="colorInput-preview"><span class="colorInput-preview-previous drag-disable"></span><span class="colorInput-preview-current"></span></div>',height:150,init:function(t){var o=this;this.$preview=$(this.template).appendTo(t.$picker),this.$current=this.$preview.find(".colorInput-preview-current"),this.$previous=this.$preview.find(".colorInput-preview-previous"),this.update(t),o.$previous.css("backgroundColor",t.color.toRGBA()),t.$picker.on("colorInput::apply",function(t,e){o.$previous.css("backgroundColor",e.color.toRGBA())})},update:function(t){this.$current.css("backgroundColor",t.color.toRGBA())}}),$.colorInput.registerComponent("saturation",{template:'<div class="colorInput-saturation drag-disable"><i class="drag-disable"><b class="drag-disable"></b></i></div>',defaults:{},options:{},width:0,height:0,size:6,data:{},init:function(t){var o=$.extend(this.defaults,t.options.components.saturation),e=this;this.options=o,this.$saturation=$(this.template).appendTo(t.$picker),this.$handle=this.$saturation.children("i"),this.step={},this.$saturation.on("mousedown.colorInput",function(o){var i=o.which?3==o.which:2==o.button;return i?!1:($.proxy(e.mousedown,e)(t,o),void 0)}),$(document).on("colorInput::ready",function(){e.width=e.$saturation.width(),e.height=e.$saturation.height(),e.step.left=e.width/20,e.step.top=e.height/20,e.size=e.$handle.width()/2,e.update(t),e.keyboard(t)})},mousedown:function(t,o){var e=this.$saturation.offset();return this.data.startY=o.pageY,this.data.startX=o.pageX,this.data.top=o.pageY-e.top,this.data.left=o.pageX-e.left,this.data.cach={},this.move(t,this.data.left,this.data.top),t.makeUnselectable(),this.mousemove=function(o){var e=this.data.left+(o.pageX||this.data.startX)-this.data.startX,i=this.data.top+(o.pageY||this.data.startY)-this.data.startY;return this.move(t,e,i),!1},this.mouseup=function(){return $(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),this.data.left=this.data.cach.left,this.data.top=this.data.cach.top,t.cancelUnselectable(),!1},$(document).on({mousemove:$.proxy(this.mousemove,this),mouseup:$.proxy(this.mouseup,this)}),!1},move:function(t,o,e,i){e=Math.max(0,Math.min(this.height,e)),o=Math.max(0,Math.min(this.width,o)),void 0===this.data.cach&&(this.data.cach={}),this.data.cach.left=o,this.data.cach.top=e,this.$handle.css({top:e-this.size,left:o-this.size}),i!==!1&&t.update({s:o/this.width,v:1-e/this.height},"saturation")},update:function(t){void 0===t.color.value.h&&(t.color.value.h=0),this.$saturation.css("backgroundColor",$.colorValue.HSLToHEX({h:t.color.value.h,s:1,l:.5}));var o=t.color.value.s*this.width,e=(1-t.color.value.v)*this.height;this.move(t,o,e,!1)},moveLeft:function(t){var o=this.step.left,e=this.data;e.left=e.left-o,e.left=Math.max(0,Math.min(this.width,e.left)),this.move(t,e.left,e.top)},moveRight:function(t){var o=this.step.left,e=this.data;e.left=e.left+o,e.left=Math.max(0,Math.min(this.width,e.left)),this.move(t,e.left,e.top)},moveUp:function(t){var o=this.step.top,e=this.data;e.top=e.top-o,e.top=Math.max(0,Math.min(this.width,e.top)),this.move(t,e.left,e.top)},moveDown:function(t){var o=this.step.top,e=this.data;e.top=e.top+o,e.top=Math.max(0,Math.min(this.width,e.top)),this.move(t,e.left,e.top)},keyboard:function(t){var o,e=this;return t._keyboard?(o=$.extend(!0,{},t._keyboard),this.$saturation.attr("tabindex","0").on("focus",function(){return o.attach({left:function(){e.moveLeft.call(e,t)},right:function(){e.moveRight.call(e,t)},up:function(){e.moveUp.call(e,t)},down:function(){e.moveDown.call(e,t)}}),!1}).on("blur",function(){o.detach()}),void 0):!1},destroy:function(){$(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}});