/*! colorInput - v0.1.3 - 2014-02-19
* https://github.com/amazingSurge/jquery-colorInput
* Copyright (c) 2014 amazingSurge; Licensed GPL */
(function(t,e,o,i,s){"use strict";function a(t){t.id=h,h++}function n(){}var h=0,r=!!/msie/i.exec(t.navigator.userAgent);t.localStorage||(t.localStorage=n);var l=o.colorInput=function(t,e){this.element=t,this.$element=o(t),this.opened=!1,this.disabled=!1,this.isFirstOpen=!0;var s=[];if(o.each(this.$element.data(),function(t,e){var o=RegExp("^color","i");o.test(t)&&(s[t.toLowerCase().replace(o,"")]=e)}),a(this),this.options=o.extend(!0,{},l.defaults,e,s),this.namespace=this.options.namespace,this.classes={input:this.namespace+"-input",skin:this.namespace+"_"+this.options.skin,show:this.namespace+"_show",mask:this.namespace+"-mask",flat:this.namespace+"_flat",showInput:this.namespace+"_showInput",disabled:this.namespace+"_disabled"},this.components=o.extend(!0,{},this.components),this.options.localStorage){var n="input_"+this.id,h=this.getLocalItem(n);h&&(this.element.value=h)}var r=l.skins[this.options.skin]||"saturation,hue";this._comps=r.split(","),this.color=""===this.element.value?new i({r:255,g:255,b:255,a:1},this.options.format):new i(this.element.value,this.options.format),this.options.showInput?this.$element.addClass(this.classes.showInput):this.options.format?this.$element.val(this.get(this.options.format)):this.$element.val(""+this.color),this.originalColor=this.color.toRGBA(),this._trigger("init"),this.init()};l.prototype={constructor:l,components:{},init:function(){var t=this;this.$picker=o('<div draggable=false class="'+this.namespace+' drag-disable"></div>'),this.$element.addClass(this.classes.input),this.options.skin&&this.$picker.addClass(this.classes.skin),this.create(),this.options.flat?(this.$element.addClass(this.classes.flat),this.$picker.addClass(this.classes.flat).insertAfter(this.$element),this.show()):(this.$picker.appendTo("body"),this.$element.on({"focus.colorInput":function(){t.show()},"keydown.colorInput":function(e){9===e.keyCode?t.hide():13===e.keyCode&&(t.color.from(t.$element.val()),t.update({},"input"),t.hide())},"keyup.colorInput":function(){t.color.from(t.$element.val()),t.update({},"input")}})),this._trigger("ready")},create:function(){var t=this;this.options.flat||this.components.trigger.init(this),o.each(this._comps,function(e,o){t.components[o]&&t.components[o].init(t)}),this.$picker.trigger("colorInput::create")},_generateMask:function(){var t=this;this.options.flat||(this.$mask=o("<div></div>").addClass(this.classes.mask).appendTo("body"),this.$mask.on("click.colorInput",function(){return t.options.hideFireChange===!1?t.cancel():t.apply(),!1}))},_clearMask:function(){this.options.flat||(this.$mask.off("click.colorInput"),this.$mask.remove(),this.$mask=null)},bindEvent:function(){o(t).on("resize.colorInput",o.proxy(this.position,this))},unbindEvent:function(){o(t).off("resize.colorInput")},_trigger:function(t){this.$element.trigger("colorInput::"+t,this),t=t.replace(/\b\w+\b/g,function(t){return t.substring(0,1).toUpperCase()+t.substring(1)});var e="on"+t,o=arguments.length>1?Array.prototype.slice.call(arguments,1):s;"function"==typeof this.options[e]&&this.options[e].apply(this,o)},update:function(t,e){var i=this;if(t!=={}&&i.color.set(t),this._trigger("change",t),o.each(this._comps,function(t,o){e!==o&&i.components[o]&&i.components[o].update&&i.components[o].update(i)}),this.options.flat||this.components.trigger.update(this),"input"!==e&&(i.options.format?i.$element.val(i.get(i.options.format)):i.$element.val(""+i.color),i.options.localStorage)){var s="input_"+this.id;i.setLocalItem(s,i.$element.val())}},opacity:function(t){return t?(this.update({a:t}),s):this.color.value.a},position:function(){var e,i,s=!this.$element.is(":visible"),a=s?this.$trigger.offset():this.$element.offset(),n=s?this.$trigger.outerHeight():this.$element.outerHeight(),h=s?this.$trigger.outerWidth():this.$element.outerWidth()+this.$trigger.outerWidth(),r=this.$picker.outerWidth(!0),l=this.$picker.outerHeight(!0);e=l+a.top>o(t).height()+o(t).scrollTop()?a.top-l:a.top+n,i=r+a.left>o(t).width()+o(t).scrollLeft()?a.left-r+h:a.left,this.$picker.css({position:"absolute",top:e,left:i})},makeUnselectable:function(){o("body").addClass("unselectable"),r&&this.$picker.find("*:not(input)").attr("unselectable","on")},cancelUnselectable:function(){o("body").removeClass("unselectable"),r&&this.$picker.find("*:not(input)").removeAttr("unselectable")},setLocalItem:function(t,e){var o=this.namespace+"_"+t,i=JSON.stringify(e);localStorage[o]=i},getLocalItem:function(t){var e=this.namespace+"_"+t,o=localStorage[e];return o?JSON.parse(o):o},show:function(){this.disabled||(this.$picker.on("mousedown",function(t){t.stopPropagation()}),this._generateMask(),this.options.flat===!1&&(this.position(),this.bindEvent()),this.$picker.addClass(this.classes.show),this.opened=!0,this.isFirstOpen=!1,this._trigger("show"))},close:function(){this.options.flat!==!0&&(this.unbindEvent(),this._clearMask(),this.$element.blur(),this.$picker.removeClass(this.classes.show),this._trigger("close"))},cancel:function(){this.color.from(this.originalColor),this.update({}),this.close()},apply:function(){this.originalColor=this.color.toRGBA(),this.close(),this._trigger("apply")},set:function(t){return this.color.from(t),this.update(),this},get:function(t){return t===s?""+this.color:"rgb"===t?this.color.toRGB():"rgba"===t?this.color.toRGBA():"hsl"===t?this.color.toHSL():"hsla"===t?this.color.toHSLA():"hex"===t?this.color.toHEX():s},enable:function(){return this.disabled=!1,this.$parent.addClass(this.classes.disabled),this},disable:function(){return this.disabled=!0,this.$parent.removeClass(this.classes.disabled),this},destroy:function(){}},l.registerComponent=function(t,e){l.prototype.components[t]=e},l.localization=[],l.defaults={namespace:"colorInput",readonly:!1,skin:null,flat:!1,showInput:!1,localStorage:!0,hideFireChange:!0,keyboard:!1,onlyBtn:!1,format:"rgb",components:{check:{applyText:"apply",cancelText:"cancel"}},onInit:function(){},onReady:function(){},onChange:function(){},onClose:function(){},onShow:function(){},onApply:function(){}},l.skins={flatSpirit:"saturation,hHue,hAlpha,hex,preview,palettes,check,gradient",realWorld:"saturation,hue,alpha,hex,preview,check",fullStack:"saturation,hue,alpha,hex,preview,gradient"},l.registerComponent("trigger",{template:'<div class="colorInput-trigger"><span></span></div>',init:function(t){t.$trigger=o(this.template),this.$trigger_inner=t.$trigger.children("span"),null!==t.options.skin&&t.$trigger.addClass(t.classes.skin),t.$trigger.insertAfter(t.$element),t.$trigger.on("click",o.proxy(t.show,t)),this.update(t)},update:function(t){this.$trigger_inner.css("backgroundColor",t.color.toRGBA())},destroy:function(t){t.$trigger.remove()}}),o.fn.colorInput=function(t){if("string"==typeof t){var e=t,i=arguments.length>1?Array.prototype.slice.call(arguments,1):s;return this.each(function(){var t=o.data(this,"colorInput");"function"==typeof t[e]&&t[e].apply(t,i)})}return this.each(function(){o.data(this,"colorInput")||o.data(this,"colorInput",new l(this,t))})}})(window,document,jQuery,function(){return void 0===$.colorValue?!1:$.colorValue}()),function(t,e,o){var i=o(e),s={keys:{UP:38,DOWN:40,LEFT:37,RIGHT:39,RETURN:13,ESCAPE:27,BACKSPACE:8,SPACE:32},map:{},bound:!1,press:function(t){var e=t.keyCode||t.which;return e in s.map&&"function"==typeof s.map[e]&&s.map[e](t),!1},attach:function(t){var e,o;for(e in t)t.hasOwnProperty(e)&&(o=e.toUpperCase(),o in s.keys?s.map[s.keys[o]]=t[e]:s.map[o]=t[e]);s.bound||(s.bound=!0,i.bind("keydown",s.press))},detach:function(){s.bound=!1,s.map={},i.unbind("keydown",s.press)}};i.on("colorInput::init",function(t,e){e.options.keyboard===!0&&(e._keyboard=s)})}(window,document,jQuery),$.colorInput.registerComponent("hAlpha",{selector:".colorInput-alpha",template:'<div class="colorInput-alpha drag-disable"><i class="drag-disable"></i></div>',width:150,data:{},init:function(t){var e=this;this.$alpha=$(this.template).appendTo(t.$picker),this.$handle=this.$alpha.children("i"),this.$alpha.on("mousedown.colorinput",function(o){var i=o.which?3==o.which:2==o.button;return i?!1:($.proxy(e.mousedown,e)(t,o),void 0)}),t.$element.on("colorInput::ready",function(){e.width=e.$alpha.width(),e.step=e.width/100,e.update(t),e.keyboard(t)})},mousedown:function(t,e){var o=this.$alpha.offset();return this.data.startX=e.pageX,this.data.left=e.pageX-o.left,this.move(t,this.data.left),t.makeUnselectable(),this.mousemove=function(e){var o=this.data.left+(e.pageX||this.data.startX)-this.data.startX;return this.move(t,o),!1},this.mouseup=function(){return $(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),this.data.left=this.data.cach,t.cancelUnselectable(),!1},$(document).on({mousemove:$.proxy(this.mousemove,this),mouseup:$.proxy(this.mouseup,this)}),!1},move:function(t,e,o,i){e=Math.max(0,Math.min(this.width,e)),this.data.cach=e,o===void 0&&(o=1-e/this.width),o=Math.max(0,Math.min(1,o)),this.$handle.css({left:e}),i!==!1&&t.update({a:Math.round(100*o)/100},"hAlpha")},moveLeft:function(t){var e=this.step,o=this.data;o.left=o.left-e,o.left=Math.max(0,Math.min(this.width,o.left)),this.move(t,o.left)},moveRight:function(t){var e=this.step,o=this.data;o.left=o.left+e,o.left=Math.max(0,Math.min(this.width,o.left)),this.move(t,o.left)},keyboard:function(t){var e,o=this;return t._keyboard?(e=$.extend(!0,{},t._keyboard),this.$alpha.attr("tabindex","0").on("focus",function(){return e.attach({left:function(){o.moveLeft.call(o,t)},right:function(){o.moveRight.call(o,t)}}),!1}).on("blur",function(){e.detach()}),void 0):!1},update:function(t){var e=this.width*(1-t.color.value.a);this.$alpha.css("backgroundColor",t.color.toHEX()),this.move(t,e,t.color.value.a,!1)},destroy:function(){$(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}}),$.colorInput.registerComponent("hHue",{selector:".colorInput-picker-hue",template:'<div class="colorInput-hue drag-disable"><i class="drag-disable"></i></div>',width:150,data:{},init:function(t){var e=this;this.$hue=$(this.template).appendTo(t.$picker),this.$handle=this.$hue.children("i"),this.$hue.on("mousedown.colorInput",function(o){var i=o.which?3==o.which:2==o.button;return i?!1:($.proxy(e.mousedown,e)(t,o),void 0)}),t.$element.on("colorInput::ready",function(){e.width=e.$hue.width(),e.step=e.width/360,e.update(t),e.keyboard(t)})},mousedown:function(t,e){var o=this.$hue.offset();return this.data.startX=e.pageX,this.data.left=e.pageX-o.left,this.move(t,this.data.left),t.makeUnselectable(),this.mousemove=function(e){var o=this.data.left+(e.pageX||this.data.startX)-this.data.startX;return this.move(t,o),!1},this.mouseup=function(){return $(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),this.data.left=this.data.cach,t.cancelUnselectable(),!1},$(document).on({mousemove:$.proxy(this.mousemove,this),mouseup:$.proxy(this.mouseup,this)}),!1},move:function(t,e,o,i){e=Math.max(0,Math.min(this.width,e)),this.data.cach=e,o===void 0&&(o=360*(1-e/this.width)),o=Math.max(0,Math.min(360,o)),this.$handle.css({left:e,background:$.colorValue.HSVtoHEX({h:o,s:1,v:1})}),i!==!1&&t.update({h:o},"hHue")},moveLeft:function(t){var e=this.step,o=this.data;o.left=o.left-e,o.left=Math.max(0,Math.min(this.width,o.left)),this.move(t,o.left)},moveRight:function(t){var e=this.step,o=this.data;o.left=o.left+e,o.left=Math.max(0,Math.min(this.width,o.left)),this.move(t,o.left)},keyboard:function(t){var e,o=this;return t._keyboard?(e=$.extend(!0,{},t._keyboard),this.$hue.attr("tabindex","0").on("focus",function(){return e.attach({left:function(){o.moveLeft.call(o,t)},right:function(){o.moveRight.call(o,t)}}),!1}).on("blur",function(){e.detach()}),void 0):!1},update:function(t){var e=0===t.color.value.h?0:this.width*(1-t.color.value.h/360);this.move(t,e,t.color.value.h,!1)},destroy:function(){$(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}}),$.colorInput.registerComponent("alpha",{selector:".colorInput-alpha",template:'<div class="colorInput-alpha drag-disable"><i class="drag-disable"></i></div>',height:150,data:{},init:function(t){var e=this;this.$alpha=$(this.template).appendTo(t.$picker),this.$handle=this.$alpha.children("i"),this.height=this.$alpha.height(),this.$alpha.on("mousedown.colorinput",function(o){var i=o.which?3==o.which:2==o.button;return i?!1:($.proxy(e.mousedown,e)(t,o),void 0)}),t.$element.on("colorInput::ready",function(){e.height=e.$alpha.height(),e.step=e.height/100,e.update(t),e.keyboard(t)})},mousedown:function(t,e){var o=this.$alpha.offset();return this.data.startY=e.pageY,this.data.top=e.pageY-o.top,this.move(t,this.data.top),t.makeUnselectable(),this.mousemove=function(e){var o=this.data.top+(e.pageY||this.data.startY)-this.data.startY;return this.move(t,o),!1},this.mouseup=function(){return $(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),this.data.top=this.data.cach,t.cancelUnselectable(),!1},$(document).on({mousemove:$.proxy(this.mousemove,this),mouseup:$.proxy(this.mouseup,this)}),!1},move:function(t,e,o,i){e=Math.max(0,Math.min(this.height,e)),this.data.cach=e,o===void 0&&(o=1-e/this.height),o=Math.max(0,Math.min(1,o)),this.$handle.css({top:e}),i!==!1&&t.update({a:Math.round(100*o)/100},"alpha")},moveUp:function(t){var e=this.step,o=this.data;o.top=o.top-e,o.top=Math.max(0,Math.min(this.width,o.top)),this.move(t,o.top)},moveDown:function(t){var e=this.step,o=this.data;o.top=o.top+e,o.top=Math.max(0,Math.min(this.width,o.top)),this.move(t,o.top)},keyboard:function(t){var e,o=this;return t._keyboard?(e=$.extend(!0,{},t._keyboard),this.$alpha.attr("tabindex","0").on("focus",function(){return e.attach({up:function(){o.moveUp.call(o,t)},down:function(){o.moveDown.call(o,t)}}),!1}).on("blur",function(){e.detach()}),void 0):!1},update:function(t){var e=this.height*(1-t.color.value.a);this.$alpha.css("backgroundColor",t.color.toHEX()),this.move(t,e,t.color.value.a,!1)},destroy:function(){$(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}}),$.colorInput.registerComponent("check",{selector:".colorInput-check",template:'<div class="colorInput-check drag-disable"><a class="colorInput-check-apply drag-disable"></a><a class="colorInput-check-cancel drag-disable"></a></div>',init:function(t){var e=$.extend(this.defaults,t.options.components.check);this.$check=$(this.template).appendTo(t.$picker),this.$apply=this.$check.find(".colorInput-check-apply").text(e.applyText),this.$cancel=this.$check.find(".colorInput-check-cancel").text(e.cancelText),this.$apply.on("click",$.proxy(t.apply,t)),this.$cancel.on("click",$.proxy(t.cancel,t))}}),$.colorInput.registerComponent("hex",{selector:".colorInput-hex",template:'<input type="text" class="colorInput-hex" />',init:function(t){this.$hex=$(this.template).appendTo(t.$picker),this.$hex.on("change",function(){t.set(this.value)}),this.update(t)},update:function(t){this.$hex.val(t.color.toHEX())}}),$.colorInput.registerComponent("hue",{selector:".colorInput-picker-hue",template:'<div class="colorInput-hue drag-disable"><i clsss="drag-disable"></i></div>',height:150,data:{},init:function(t){var e=this;this.$hue=$(this.template).appendTo(t.$picker),this.$handle=this.$hue.children("i"),this.height=this.$hue.height(),this.$hue.on("mousedown.colorInput",function(o){var i=o.which?3==o.which:2==o.button;return i?!1:($.proxy(e.mousedown,e)(t,o),void 0)}),t.$element.on("colorInput::ready",function(){e.height=e.$hue.height(),e.step=e.height/360,e.update(t),e.keyboard(t)})},mousedown:function(t,e){var o=this.$hue.offset();return this.data.startY=e.pageY,this.data.top=e.pageY-o.top,this.move(t,this.data.top),t.makeUnselectable(),this.mousemove=function(e){var o=this.data.top+(e.pageY||this.data.startY)-this.data.startY;return this.move(t,o),!1},this.mouseup=function(){return $(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),this.data.top=this.data.cach,t.cancelUnselectable(),!1},$(document).on({mousemove:$.proxy(this.mousemove,this),mouseup:$.proxy(this.mouseup,this)}),!1},move:function(t,e,o,i){e=Math.max(0,Math.min(this.height,e)),this.data.cach=e,o===void 0&&(o=360*(1-e/this.height)),o=Math.max(0,Math.min(360,o)),this.$handle.css({top:e}),i!==!1&&t.update({h:o},"hue")},moveUp:function(t){var e=this.step,o=this.data;o.top=o.top-e,o.top=Math.max(0,Math.min(this.width,o.top)),this.move(t,o.top)},moveDown:function(t){var e=this.step,o=this.data;o.top=o.top+e,o.top=Math.max(0,Math.min(this.width,o.top)),this.move(t,o.top)},update:function(t){var e=0===t.color.value.h?0:this.height*(1-t.color.value.h/360);this.move(t,e,t.color.value.h,!1)},keyboard:function(t){var e,o=this;return t._keyboard?(e=$.extend(!0,{},t._keyboard),this.$hue.attr("tabindex","0").on("focus",function(){return e.attach({up:function(){o.moveUp.call(o,t)},down:function(){o.moveDown.call(o,t)}}),!1}).on("blur",function(){e.detach()}),void 0):!1},destroy:function(){$(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}}),$.colorInput.registerComponent("info",{selector:".colorInput-info",template:'<ul class="colorInput-info"><li><label>R:<input type="text" data-type="r"/></label></li><li><label>G:<input type="text" data-type="g"/></label></li><li><label>B:<input type="text" data-type="b"/></label></li><li><label>A:<input type="text" data-type="a"/></label></li></ul>',color:["white","black","transparent"],init:function(t){this.$info=$(this.template).appendTo(t.$picker),this.$r=this.$info.find('[data-type="r"]'),this.$g=this.$info.find('[data-type="g"]'),this.$b=this.$info.find('[data-type="b"]'),this.$a=this.$info.find('[data-type="a"]'),this.$info.delegate("input","keyup update change",function(e){var o,i=$(e.target).data("type");switch(i){case"r":case"g":case"b":o=parseInt(this.value,10),o>255?o=255:0>o&&(o=0);break;case"a":o=parseFloat(this.value,10),o>1?o=1:0>o&&(o=0)}isNaN(o)&&(o=0);var s={};s[i]=o,t.value(s)}),this.update(t)},update:function(t){this.$r.val(t.color.value.r),this.$g.val(t.color.value.g),this.$b.val(t.color.value.b),this.$a.val(t.color.value.a)}}),$.colorInput.registerComponent("palettes",{selector:".colorInput-palettes",template:'<div class="colorInput-palettes"></div>',height:150,palettes:{defines:[""],colors:["#fff","#000","#000","#ccc"],max:6},init:function(t){var e="<ul>",o=this,i=$.extend(!0,{},this.palettes,t.options.components.palettes);if(this.keyboardBinded=!1,t.options.localStorage){var s="palettes_"+t.id,a=t.getLocalItem(s);a&&(i.colors=a)}$.each(i.colors,function(t,o){e+='<li style="background-color:'+o+'" data-color="'+o+'">'+o+"</li>"}),e+="</ul>",this.$list=$(e),this.$palettes=$(this.template).append(this.$list).appendTo(t.$picker),this.$palettes.delegate("li","click",function(e){var i=$(e.target).data("color");o.$list.find("li").removeClass("colorInput-palettes-checked"),$(e.target).addClass("colorInput-palettes-checked"),t.set(i),t.close()}),this.$palettes.attr("tabindex","0").on("blur",function(){o.$list.find("li").removeClass("colorInput-palettes-checked")}),t.$element.on("colorInput::apply",function(t,e){-1===i.colors.indexOf(e.originalColor)&&(i.colors.length>=i.max&&(i.colors.shift(),o.$list.find("li").eq(0).remove()),i.colors.push(e.originalColor),o.$list.append('<li style="background-color:'+e.originalColor+'" data-color="'+e.originalColor+'">'+e.originalColor+"</li>"),e.options.localStorage&&e.setLocalItem(s,i.colors))}),t.$element.on("colorInput::ready",function(){return o.keyboard(t),!1})},keyboard:function(t){var e,o,i,s=this;return t._keyboard?(e=$.extend(!0,{},t._keyboard),this.$palettes.attr("tabindex","0").on("blur",function(){e.detach(),s.keyboardBinded=!1}),this.$palettes.attr("tabindex","0").on("focus",function(){function a(t){h.removeClass("colorInput-palettes-checked"),h.eq(t).addClass("colorInput-palettes-checked")}function n(){return h.index(s.$palettes.find(".colorInput-palettes-checked"))}if(s.keyboardBinded!==!0){var h=s.$list.find("li");o=-1,i=h.length,e.attach({left:function(){var t=n();-1===t?o-=1:o=t-1,0>o&&(o=i-1),a(o)},right:function(){var t=n();-1===t?o+=1:o=t+1,o>=i&&(o=0),a(o)},RETURN:function(){if(!(0>o)){var e=h.eq(o).data("color");t.set(e),t.close()}}}),s.keyboardBinded=!0}}),void 0):!1}}),$.colorInput.registerComponent("preview",{selector:".colorInput-preview",template:'<div class="colorInput-preview"><span class="colorInput-preview-previous drag-disable"></span><span class="colorInput-preview-current"></span></div>',height:150,init:function(t){var e=this;this.$preview=$(this.template).appendTo(t.$picker),this.$current=this.$preview.find(".colorInput-preview-current"),this.$previous=this.$preview.find(".colorInput-preview-previous"),this.update(t),e.$previous.css("backgroundColor",t.color.toRGBA()),t.$picker.on("colorInput::apply",function(t,o){e.$previous.css("backgroundColor",o.color.toRGBA())})},update:function(t){this.$current.css("backgroundColor",t.color.toRGBA())}}),$.colorInput.registerComponent("saturation",{template:'<div class="colorInput-saturation drag-disable"><i class="drag-disable"><b class="drag-disable"></b></i></div>',defaults:{},options:{},width:0,height:0,size:6,data:{},init:function(t){var e=$.extend(this.defaults,t.options.components.saturation),o=this;this.options=e,this.$saturation=$(this.template).appendTo(t.$picker),this.$handle=this.$saturation.children("i"),this.step={},this.$saturation.on("mousedown.colorInput",function(e){var i=e.which?3===e.which:2===e.button;return i?!1:($.proxy(o.mousedown,o)(t,e),void 0)}),t.$element.on("colorInput::ready",function(){o.width=o.$saturation.width(),o.height=o.$saturation.height(),o.step.left=o.width/20,o.step.top=o.height/20,o.size=o.$handle.width()/2,o.update(t),o.keyboard(t)})},mousedown:function(t,e){var o=this.$saturation.offset();return this.data.startY=e.pageY,this.data.startX=e.pageX,this.data.top=e.pageY-o.top,this.data.left=e.pageX-o.left,this.data.cach={},this.move(t,this.data.left,this.data.top),t.makeUnselectable(),this.mousemove=function(e){var o=this.data.left+(e.pageX||this.data.startX)-this.data.startX,i=this.data.top+(e.pageY||this.data.startY)-this.data.startY;return this.move(t,o,i),!1},this.mouseup=function(){return $(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),this.data.left=this.data.cach.left,this.data.top=this.data.cach.top,t.cancelUnselectable(),!1},$(document).on({mousemove:$.proxy(this.mousemove,this),mouseup:$.proxy(this.mouseup,this)}),!1},move:function(t,e,o,i){o=Math.max(0,Math.min(this.height,o)),e=Math.max(0,Math.min(this.width,e)),void 0===this.data.cach&&(this.data.cach={}),this.data.cach.left=e,this.data.cach.top=o,this.$handle.css({top:o-this.size,left:e-this.size}),i!==!1&&t.update({s:e/this.width,v:1-o/this.height},"saturation")},update:function(t){void 0===t.color.value.h&&(t.color.value.h=0),this.$saturation.css("backgroundColor",$.colorValue.HSLToHEX({h:t.color.value.h,s:1,l:.5}));var e=t.color.value.s*this.width,o=(1-t.color.value.v)*this.height;this.move(t,e,o,!1)},moveLeft:function(t){var e=this.step.left,o=this.data;o.left=o.left-e,o.left=Math.max(0,Math.min(this.width,o.left)),this.move(t,o.left,o.top)},moveRight:function(t){var e=this.step.left,o=this.data;o.left=o.left+e,o.left=Math.max(0,Math.min(this.width,o.left)),this.move(t,o.left,o.top)},moveUp:function(t){var e=this.step.top,o=this.data;o.top=o.top-e,o.top=Math.max(0,Math.min(this.width,o.top)),this.move(t,o.left,o.top)},moveDown:function(t){var e=this.step.top,o=this.data;o.top=o.top+e,o.top=Math.max(0,Math.min(this.width,o.top)),this.move(t,o.left,o.top)},keyboard:function(t){var e,o=this;return t._keyboard?(e=$.extend(!0,{},t._keyboard),this.$saturation.attr("tabindex","0").on("focus",function(){return e.attach({left:function(){o.moveLeft.call(o,t)},right:function(){o.moveRight.call(o,t)},up:function(){o.moveUp.call(o,t)},down:function(){o.moveDown.call(o,t)}}),!1}).on("blur",function(){e.detach()}),void 0):!1},destroy:function(){$(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}});