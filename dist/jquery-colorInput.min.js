/*! colorInput - v0.1.3 - 2014-03-14
* https://github.com/amazingSurge/jquery-colorInput
* Copyright (c) 2014 amazingSurge; Licensed GPL */
(function(t,e,i,o,s){"use strict";function a(t){t.id=h,h++}function n(){}var h=0,r=!!/msie/i.exec(t.navigator.userAgent);t.localStorage||(t.localStorage=n);var c=i.colorInput=function(t,e){this.element=t,this.$element=i(t),this.opened=!1,this.disabled=!1,this.isFirstOpen=!0;var s=[];if(i.each(this.$element.data(),function(t,e){var i=RegExp("^color","i");i.test(t)&&(s[t.toLowerCase().replace(i,"")]=e)}),a(this),this.options=i.extend(!0,{},c.defaults,e,s),this.namespace=this.options.namespace,this.classes={input:this.namespace+"-input",skin:this.namespace+"_"+this.options.skin,show:this.namespace+"_show",mask:this.namespace+"-mask",flat:this.namespace+"_flat",showInput:this.namespace+"_showInput",disabled:this.namespace+"_disabled"},this.components=i.extend(!0,{},this.components),this.options.localStorage){var n="input_"+this.id,h=this.getLocalItem(n);h&&(this.element.value=h)}var r=c.skins[this.options.skin]||"saturation,hue";this._comps=r.split(","),this.color=""===this.element.value?new o({r:255,g:255,b:255,a:1},this.options.format):new o(this.element.value,this.options.format),this.options.showInput?this.$element.addClass(this.classes.showInput):this.options.format?this.$element.val(this.get(this.options.format)):this.$element.val(""+this.color),this.originalColor=this.color.toRGBA(),this._trigger("init"),this.init()};c.prototype={constructor:c,components:{},init:function(){var t=this;this.$picker=i('<div draggable=false class="'+this.namespace+' drag-disable"></div>'),this.$element.addClass(this.classes.input),this.options.skin&&this.$picker.addClass(this.classes.skin),this.create(),this.options.flat?(this.$element.addClass(this.classes.flat),this.$picker.addClass(this.classes.flat).insertAfter(this.$element),this.show()):(this.$picker.appendTo("body"),this.$element.on({"focus.colorInput":function(){t.show()},"keydown.colorInput":function(e){9===e.keyCode?t.hide():13===e.keyCode&&(t.color.from(t.$element.val()),t.update({},"input"),t.hide())},"keyup.colorInput":function(){t.color.from(t.$element.val()),t.update({},"input")}})),this._trigger("ready")},create:function(){var t=this;this.options.flat||this.components.trigger.init(this),i.each(this._comps,function(e,i){t.components[i]&&t.components[i].init(t)}),this.$picker.trigger("colorInput::create")},_generateMask:function(){var t=this;this.options.flat||(this.$mask=i("<div></div>").addClass(this.classes.mask).appendTo("body"),this.$mask.on("click.colorInput",function(){return t.options.hideFireChange===!1?t.cancel():t.apply(),!1}))},_clearMask:function(){this.options.flat||(this.$mask.off("click.colorInput"),this.$mask.remove(),this.$mask=null)},bindEvent:function(){i(t).on("resize.colorInput",i.proxy(this.position,this))},unbindEvent:function(){i(t).off("resize.colorInput")},_trigger:function(t){this.$element.trigger("colorInput::"+t,this),t=t.replace(/\b\w+\b/g,function(t){return t.substring(0,1).toUpperCase()+t.substring(1)});var e="on"+t,i=arguments.length>1?Array.prototype.slice.call(arguments,1):s;"function"==typeof this.options[e]&&this.options[e].apply(this,i)},update:function(t,e){var o=this;if(t!=={}&&o.color.set(t),this._trigger("change",t),i.each(this._comps,function(t,i){e!==i&&o.components[i]&&o.components[i].update&&o.components[i].update(o)}),this.options.flat||this.components.trigger.update(this),"input"!==e&&(o.options.format?o.$element.val(o.get(o.options.format)):o.$element.val(""+o.color),o.options.localStorage)){var s="input_"+this.id;o.setLocalItem(s,o.$element.val())}},opacity:function(t){return t?(this.update({a:t}),s):this.color.value.a},position:function(){var e,o,s=!this.$element.is(":visible"),a=s?this.$trigger.offset():this.$element.offset(),n=s?this.$trigger.outerHeight():this.$element.outerHeight(),h=s?this.$trigger.outerWidth():this.$element.outerWidth()+this.$trigger.outerWidth(),r=this.$picker.outerWidth(!0),c=this.$picker.outerHeight(!0);e=c+a.top>i(t).height()+i(t).scrollTop()?a.top-c:a.top+n,o=r+a.left>i(t).width()+i(t).scrollLeft()?a.left-r+h:a.left,this.$picker.css({position:"absolute",top:e,left:o})},makeUnselectable:function(){i("body").addClass("unselectable"),r&&this.$picker.find("*:not(input)").attr("unselectable","on")},cancelUnselectable:function(){i("body").removeClass("unselectable"),r&&this.$picker.find("*:not(input)").removeAttr("unselectable")},setLocalItem:function(t,e){var i=this.namespace+"_"+t,o=JSON.stringify(e);localStorage[i]=o},getLocalItem:function(t){var e=this.namespace+"_"+t,i=localStorage[e];return i?JSON.parse(i):i},show:function(){this.disabled||(this.$picker.on("mousedown",function(t){t.stopPropagation()}),this._generateMask(),this.options.flat===!1&&(this.position(),this.bindEvent()),this.$picker.addClass(this.classes.show),this.opened=!0,this.isFirstOpen=!1,this._trigger("show"))},close:function(){this.options.flat!==!0&&(this.unbindEvent(),this._clearMask(),this.$element.blur(),this.$picker.removeClass(this.classes.show),this._trigger("close"))},cancel:function(){this.color.from(this.originalColor),this.update({}),this.close()},apply:function(){this.originalColor=this.color.toRGBA(),this.close(),this._trigger("apply")},set:function(t){return this.color.from(t),this.update(),this},get:function(t){return t===s?""+this.color:"rgb"===t?this.color.toRGB():"rgba"===t?this.color.toRGBA():"hsl"===t?this.color.toHSL():"hsla"===t?this.color.toHSLA():"hex"===t?this.color.toHEX():s},enable:function(){return this.disabled=!1,this.$parent.addClass(this.classes.disabled),this},disable:function(){return this.disabled=!0,this.$parent.removeClass(this.classes.disabled),this},destroy:function(){}},c.registerComponent=function(t,e){c.prototype.components[t]=e},c.localization=[],c.defaults={namespace:"colorInput",readonly:!1,skin:null,flat:!1,showInput:!1,localStorage:!0,hideFireChange:!0,keyboard:!1,onlyBtn:!1,format:"rgb",components:{check:{applyText:"apply",cancelText:"cancel"}},onInit:function(){},onReady:function(){},onChange:function(){},onClose:function(){},onShow:function(){},onApply:function(){}},c.skins={flatSpirit:"saturation,hHue,hAlpha,hex,preview,palettes,check,gradient",realWorld:"saturation,hue,alpha,hex,preview,check",fullStack:"saturation,hue,alpha,hex,preview,palettes,gradient"},c.registerComponent("trigger",{template:'<div class="colorInput-trigger"><span></span></div>',init:function(t){t.$trigger=i(this.template),this.$trigger_inner=t.$trigger.children("span"),null!==t.options.skin&&t.$trigger.addClass(t.classes.skin),t.$trigger.insertAfter(t.$element),t.$trigger.on("click",i.proxy(t.show,t)),this.update(t)},update:function(t){this.$trigger_inner.css("backgroundColor",t.color.toRGBA())},destroy:function(t){t.$trigger.remove()}}),i.fn.colorInput=function(t){if("string"==typeof t){var e=t,o=arguments.length>1?Array.prototype.slice.call(arguments,1):s;return this.each(function(){var t=i.data(this,"colorInput");"function"==typeof t[e]&&t[e].apply(t,o)})}return this.each(function(){i.data(this,"colorInput")||i.data(this,"colorInput",new c(this,t))})}})(window,document,jQuery,function(){return void 0===$.colorValue?(console.info("lost dependency lib of $.colorValue , please load it first !"),!1):$.colorValue}()),function(t,e,i){var o=i(e),s={keys:{UP:38,DOWN:40,LEFT:37,RIGHT:39,RETURN:13,ESCAPE:27,BACKSPACE:8,SPACE:32},map:{},bound:!1,press:function(t){var e=t.keyCode||t.which;return e in s.map&&"function"==typeof s.map[e]&&s.map[e](t),!1},attach:function(t){var e,i;for(e in t)t.hasOwnProperty(e)&&(i=e.toUpperCase(),i in s.keys?s.map[s.keys[i]]=t[e]:s.map[i]=t[e]);s.bound||(s.bound=!0,o.bind("keydown",s.press))},detach:function(){s.bound=!1,s.map={},o.unbind("keydown",s.press)}};o.on("colorInput::init",function(t,e){e.options.keyboard===!0&&(e._keyboard=s)})}(window,document,jQuery),function(t){t.colorInput.registerComponent("hAlpha",{width:150,data:{},init:function(e){var i=this,o='<div class="'+e.namespace+'-alpha drag-disable"><i class="drag-disable"></i></div>';this.$alpha=t(o).appendTo(e.$picker),this.$handle=this.$alpha.children("i"),this.$alpha.on("mousedown.colorinput",function(o){var s=o.which?3==o.which:2==o.button;return s?!1:(t.proxy(i.mousedown,i)(e,o),void 0)}),e.$element.on("colorInput::ready",function(){i.width=i.$alpha.width(),i.step=i.width/100,i.update(e),i.keyboard(e)})},mousedown:function(e,i){var o=this.$alpha.offset();return this.data.startX=i.pageX,this.data.left=i.pageX-o.left,this.move(e,this.data.left),e.makeUnselectable(),this.mousemove=function(t){var i=this.data.left+(t.pageX||this.data.startX)-this.data.startX;return this.move(e,i),!1},this.mouseup=function(){return t(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),this.data.left=this.data.cach,e.cancelUnselectable(),!1},t(document).on({mousemove:t.proxy(this.mousemove,this),mouseup:t.proxy(this.mouseup,this)}),!1},move:function(t,e,i,o){e=Math.max(0,Math.min(this.width,e)),this.data.cach=e,i===void 0&&(i=1-e/this.width),i=Math.max(0,Math.min(1,i)),this.$handle.css({left:e}),o!==!1&&t.update({a:Math.round(100*i)/100},"hAlpha")},moveLeft:function(t){var e=this.step,i=this.data;i.left=i.left-e,i.left=Math.max(0,Math.min(this.width,i.left)),this.move(t,i.left)},moveRight:function(t){var e=this.step,i=this.data;i.left=i.left+e,i.left=Math.max(0,Math.min(this.width,i.left)),this.move(t,i.left)},keyboard:function(e){var i,o=this;return e._keyboard?(i=t.extend(!0,{},e._keyboard),this.$alpha.attr("tabindex","0").on("focus",function(){return i.attach({left:function(){o.moveLeft.call(o,e)},right:function(){o.moveRight.call(o,e)}}),!1}).on("blur",function(){i.detach()}),void 0):!1},update:function(t){var e=this.width*(1-t.color.value.a);this.$alpha.css("backgroundColor",t.color.toHEX()),this.move(t,e,t.color.value.a,!1)},destroy:function(){t(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}})}(jQuery),function(t){t.colorInput.registerComponent("hHue",{width:150,data:{},init:function(e){var i=this,o='<div class="'+e.namespace+'-hue drag-disable"><i class="drag-disable"></i></div>';this.$hue=t(o).appendTo(e.$picker),this.$handle=this.$hue.children("i"),this.$hue.on("mousedown.colorInput",function(o){var s=o.which?3===o.which:2===o.button;return s?!1:(t.proxy(i.mousedown,i)(e,o),void 0)}),e.$element.on("colorInput::ready",function(){i.width=i.$hue.width(),i.step=i.width/360,i.update(e),i.keyboard(e)})},mousedown:function(e,i){var o=this.$hue.offset();return this.data.startX=i.pageX,this.data.left=i.pageX-o.left,this.move(e,this.data.left),e.makeUnselectable(),this.mousemove=function(t){var i=this.data.left+(t.pageX||this.data.startX)-this.data.startX;return this.move(e,i),!1},this.mouseup=function(){return t(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),this.data.left=this.data.cach,e.cancelUnselectable(),!1},t(document).on({mousemove:t.proxy(this.mousemove,this),mouseup:t.proxy(this.mouseup,this)}),!1},move:function(e,i,o,s){i=Math.max(0,Math.min(this.width,i)),this.data.cach=i,o===void 0&&(o=360*(1-i/this.width)),o=Math.max(0,Math.min(360,o)),this.$handle.css({left:i,background:t.colorValue.HSVtoHEX({h:o,s:1,v:1})}),s!==!1&&e.update({h:o},"hHue")},moveLeft:function(t){var e=this.step,i=this.data;i.left=i.left-e,i.left=Math.max(0,Math.min(this.width,i.left)),this.move(t,i.left)},moveRight:function(t){var e=this.step,i=this.data;i.left=i.left+e,i.left=Math.max(0,Math.min(this.width,i.left)),this.move(t,i.left)},keyboard:function(e){var i,o=this;return e._keyboard?(i=t.extend(!0,{},e._keyboard),this.$hue.attr("tabindex","0").on("focus",function(){return i.attach({left:function(){o.moveLeft.call(o,e)},right:function(){o.moveRight.call(o,e)}}),!1}).on("blur",function(){i.detach()}),void 0):!1},update:function(t){var e=0===t.color.value.h?0:this.width*(1-t.color.value.h/360);this.move(t,e,t.color.value.h,!1)},destroy:function(){t(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}})}(jQuery),function(t){t.colorInput.registerComponent("alpha",{height:150,data:{},init:function(e){var i=this;this.$alpha=t('<div class="'+e.namespace+'-alpha drag-disable"><i class="drag-disable"></i></div>').appendTo(e.$picker),this.$handle=this.$alpha.children("i"),this.height=this.$alpha.height(),this.$alpha.on("mousedown.colorinput",function(o){var s=o.which?3==o.which:2==o.button;return s?!1:(t.proxy(i.mousedown,i)(e,o),void 0)}),e.$element.on("colorInput::ready",function(){i.height=i.$alpha.height(),i.step=i.height/100,i.update(e),i.keyboard(e)})},mousedown:function(e,i){var o=this.$alpha.offset();return this.data.startY=i.pageY,this.data.top=i.pageY-o.top,this.move(e,this.data.top),e.makeUnselectable(),this.mousemove=function(t){var i=this.data.top+(t.pageY||this.data.startY)-this.data.startY;return this.move(e,i),!1},this.mouseup=function(){return t(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),this.data.top=this.data.cach,e.cancelUnselectable(),!1},t(document).on({mousemove:t.proxy(this.mousemove,this),mouseup:t.proxy(this.mouseup,this)}),!1},move:function(t,e,i,o){e=Math.max(0,Math.min(this.height,e)),this.data.cach=e,i===void 0&&(i=1-e/this.height),i=Math.max(0,Math.min(1,i)),this.$handle.css({top:e}),o!==!1&&t.update({a:Math.round(100*i)/100},"alpha")},moveUp:function(t){var e=this.step,i=this.data;i.top=i.top-e,i.top=Math.max(0,Math.min(this.width,i.top)),this.move(t,i.top)},moveDown:function(t){var e=this.step,i=this.data;i.top=i.top+e,i.top=Math.max(0,Math.min(this.width,i.top)),this.move(t,i.top)},keyboard:function(e){var i,o=this;return e._keyboard?(i=t.extend(!0,{},e._keyboard),this.$alpha.attr("tabindex","0").on("focus",function(){return i.attach({up:function(){o.moveUp.call(o,e)},down:function(){o.moveDown.call(o,e)}}),!1}).on("blur",function(){i.detach()}),void 0):!1},update:function(t){var e=this.height*(1-t.color.value.a);this.$alpha.css("backgroundColor",t.color.toHEX()),this.move(t,e,t.color.value.a,!1)},destroy:function(){t(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}})}(jQuery),function(t){t.colorInput.registerComponent("check",{init:function(e){var i=t.extend(this.defaults,e.options.components.check),o='<div class="'+e.namespace+'-check drag-disable"><a class="'+e.namespace+'-check-apply drag-disable"></a><a class="'+e.namespace+'-check-cancel drag-disable"></a></div>';this.$check=t(o).appendTo(e.$picker),this.$apply=this.$check.find("."+e.namespace+"-check-apply").text(i.applyText),this.$cancel=this.$check.find("."+e.namespace+"-check-cancel").text(i.cancelText),this.$apply.on("click",t.proxy(e.apply,e)),this.$cancel.on("click",t.proxy(e.cancel,e))}})}(jQuery),function(t){t.colorInput.registerComponent("hex",{init:function(e){var i='<input type="text" class="'+e.namespace+'-hex" />';this.$hex=t(i).appendTo(e.$picker),this.$hex.on("change",function(){e.set(this.value)}),this.update(e)},update:function(t){this.$hex.val(t.color.toHEX())}})}(jQuery),function(t){t.colorInput.registerComponent("hue",{height:150,data:{},init:function(e){var i=this,o='<div class="'+e.namespace+'-hue drag-disable"><i clsss="drag-disable"></i></div>';this.$hue=t(o).appendTo(e.$picker),this.$handle=this.$hue.children("i"),this.height=this.$hue.height(),this.$hue.on("mousedown.colorInput",function(o){var s=o.which?3===o.which:2===o.button;return s?!1:(t.proxy(i.mousedown,i)(e,o),void 0)}),e.$element.on("colorInput::ready",function(){i.height=i.$hue.height(),i.step=i.height/360,i.update(e),i.keyboard(e)})},mousedown:function(e,i){var o=this.$hue.offset();return this.data.startY=i.pageY,this.data.top=i.pageY-o.top,this.move(e,this.data.top),e.makeUnselectable(),this.mousemove=function(t){var i=this.data.top+(t.pageY||this.data.startY)-this.data.startY;return this.move(e,i),!1},this.mouseup=function(){return t(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),this.data.top=this.data.cach,e.cancelUnselectable(),!1},t(document).on({mousemove:t.proxy(this.mousemove,this),mouseup:t.proxy(this.mouseup,this)}),!1},move:function(t,e,i,o){e=Math.max(0,Math.min(this.height,e)),this.data.cach=e,i===void 0&&(i=360*(1-e/this.height)),i=Math.max(0,Math.min(360,i)),this.$handle.css({top:e}),o!==!1&&t.update({h:i},"hue")},moveUp:function(t){var e=this.step,i=this.data;i.top=i.top-e,i.top=Math.max(0,Math.min(this.width,i.top)),this.move(t,i.top)},moveDown:function(t){var e=this.step,i=this.data;i.top=i.top+e,i.top=Math.max(0,Math.min(this.width,i.top)),this.move(t,i.top)},update:function(t){var e=0===t.color.value.h?0:this.height*(1-t.color.value.h/360);this.move(t,e,t.color.value.h,!1)},keyboard:function(e){var i,o=this;return e._keyboard?(i=t.extend(!0,{},e._keyboard),this.$hue.attr("tabindex","0").on("focus",function(){return i.attach({up:function(){o.moveUp.call(o,e)},down:function(){o.moveDown.call(o,e)}}),!1}).on("blur",function(){i.detach()}),void 0):!1},destroy:function(){t(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}})}(jQuery),function(t){t.colorInput.registerComponent("info",{color:["white","black","transparent"],init:function(e){var i='<ul class="'+e.namespace+'-info">'+'<li><label>R:<input type="text" data-type="r"/></label></li>'+'<li><label>G:<input type="text" data-type="g"/></label></li>'+'<li><label>B:<input type="text" data-type="b"/></label></li>'+'<li><label>A:<input type="text" data-type="a"/></label></li>'+"</ul>";this.$info=t(i).appendTo(e.$picker),this.$r=this.$info.find('[data-type="r"]'),this.$g=this.$info.find('[data-type="g"]'),this.$b=this.$info.find('[data-type="b"]'),this.$a=this.$info.find('[data-type="a"]'),this.$info.delegate("input","keyup update change",function(i){var o,s=t(i.target).data("type");switch(s){case"r":case"g":case"b":o=parseInt(this.value,10),o>255?o=255:0>o&&(o=0);break;case"a":o=parseFloat(this.value,10),o>1?o=1:0>o&&(o=0)}isNaN(o)&&(o=0);var a={};a[s]=o,e.value(a)}),this.update(e)},update:function(t){this.$r.val(t.color.value.r),this.$g.val(t.color.value.g),this.$b.val(t.color.value.b),this.$a.val(t.color.value.a)}})}(jQuery),function(t){t.colorInput.registerComponent("palettes",{height:150,palettes:{defines:[""],colors:["#fff","#000","#000","#ccc"],max:6},init:function(e){var i="<ul>",o=this,s=t.extend(!0,{},this.palettes,e.options.components.palettes);if(this.keyboardBinded=!1,e.options.localStorage){var a="palettes_"+e.id,n=e.getLocalItem(a);n&&(s.colors=n)}t.each(s.colors,function(t,e){i+='<li style="background-color:'+e+'" data-color="'+e+'">'+e+"</li>"}),i+="</ul>",this.$list=t(i),this.$palettes=t('<div class="'+e.namespace+'-palettes"></div>').append(this.$list).appendTo(e.$picker),this.$palettes.delegate("li","click",function(i){var s=t(i.target).data("color");o.$list.find("li").removeClass(""+e.namespace+"-palettes-checked"),t(i.target).addClass(""+e.namespace+"-palettes-checked"),e.set(s),e.close()}),this.$palettes.attr("tabindex","0").on("blur",function(){o.$list.find("li").removeClass(""+e.namespace+"-palettes-checked")}),e.$element.on("colorInput::apply",function(t,e){-1===s.colors.indexOf(e.originalColor)&&(s.colors.length>=s.max&&(s.colors.shift(),o.$list.find("li").eq(0).remove()),s.colors.push(e.originalColor),o.$list.append('<li style="background-color:'+e.originalColor+'" data-color="'+e.originalColor+'">'+e.originalColor+"</li>"),e.options.localStorage&&e.setLocalItem(a,s.colors))}),e.$element.on("colorInput::ready",function(){return o.keyboard(e),!1})},keyboard:function(e){var i,o,s,a=this;return e._keyboard?(i=t.extend(!0,{},e._keyboard),this.$palettes.attr("tabindex","0").on("blur",function(){i.detach(),a.keyboardBinded=!1}),this.$palettes.attr("tabindex","0").on("focus",function(){function t(t){h.removeClass(""+e.namespace+"-palettes-checked"),h.eq(t).addClass("colorInput-palettes-checked")}function n(){return h.index(a.$palettes.find("."+e.namespace+"-palettes-checked"))}if(a.keyboardBinded!==!0){var h=a.$list.find("li");o=-1,s=h.length,i.attach({left:function(){var e=n();-1===e?o-=1:o=e-1,0>o&&(o=s-1),t(o)},right:function(){var e=n();-1===e?o+=1:o=e+1,o>=s&&(o=0),t(o)},RETURN:function(){if(!(0>o)){var t=h.eq(o).data("color");e.set(t),e.close()}}}),a.keyboardBinded=!0}}),void 0):!1}})}(jQuery),function(t){t.colorInput.registerComponent("preview",{height:150,init:function(e){var i=this,o='<div class="'+e.namespace+'-preview"><span class="'+e.namespace+'-preview-previous drag-disable"></span><span class="'+e.namespace+'-preview-current"></span></div>';this.$preview=t(o).appendTo(e.$picker),this.$current=this.$preview.find("."+e.namespace+"-preview-current"),this.$previous=this.$preview.find("."+e.namespace+"-preview-previous"),this.update(e),i.$previous.css("backgroundColor",e.color.toRGBA()),e.$picker.on("colorInput::apply",function(t,e){i.$previous.css("backgroundColor",e.color.toRGBA())})},update:function(t){this.$current.css("backgroundColor",t.color.toRGBA())}})}(jQuery),function(t){t.colorInput.registerComponent("saturation",{defaults:{},options:{},width:0,height:0,size:6,data:{},init:function(e){var i=t.extend(this.defaults,e.options.components.saturation),o=this,s='<div class="'+e.namespace+'-saturation drag-disable"><i class="drag-disable"><b class="drag-disable"></b></i></div>';this.options=i,this.$saturation=t(s).appendTo(e.$picker),this.$handle=this.$saturation.children("i"),this.step={},this.$saturation.on("mousedown.colorInput",function(i){var s=i.which?3===i.which:2===i.button;return s?!1:(t.proxy(o.mousedown,o)(e,i),void 0)}),e.$element.on("colorInput::ready",function(){o.width=o.$saturation.width(),o.height=o.$saturation.height(),o.step.left=o.width/20,o.step.top=o.height/20,o.size=o.$handle.width()/2,o.update(e),o.keyboard(e)})},mousedown:function(e,i){var o=this.$saturation.offset();return this.data.startY=i.pageY,this.data.startX=i.pageX,this.data.top=i.pageY-o.top,this.data.left=i.pageX-o.left,this.data.cach={},this.move(e,this.data.left,this.data.top),e.makeUnselectable(),this.mousemove=function(t){var i=this.data.left+(t.pageX||this.data.startX)-this.data.startX,o=this.data.top+(t.pageY||this.data.startY)-this.data.startY;return this.move(e,i,o),!1},this.mouseup=function(){return t(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),this.data.left=this.data.cach.left,this.data.top=this.data.cach.top,e.cancelUnselectable(),!1},t(document).on({mousemove:t.proxy(this.mousemove,this),mouseup:t.proxy(this.mouseup,this)}),!1},move:function(t,e,i,o){i=Math.max(0,Math.min(this.height,i)),e=Math.max(0,Math.min(this.width,e)),void 0===this.data.cach&&(this.data.cach={}),this.data.cach.left=e,this.data.cach.top=i,this.$handle.css({top:i-this.size,left:e-this.size}),o!==!1&&t.update({s:e/this.width,v:1-i/this.height},"saturation")},update:function(e){void 0===e.color.value.h&&(e.color.value.h=0),this.$saturation.css("backgroundColor",t.colorValue.HSLToHEX({h:e.color.value.h,s:1,l:.5}));var i=e.color.value.s*this.width,o=(1-e.color.value.v)*this.height;this.move(e,i,o,!1)},moveLeft:function(t){var e=this.step.left,i=this.data;i.left=i.left-e,i.left=Math.max(0,Math.min(this.width,i.left)),this.move(t,i.left,i.top)},moveRight:function(t){var e=this.step.left,i=this.data;i.left=i.left+e,i.left=Math.max(0,Math.min(this.width,i.left)),this.move(t,i.left,i.top)},moveUp:function(t){var e=this.step.top,i=this.data;i.top=i.top-e,i.top=Math.max(0,Math.min(this.width,i.top)),this.move(t,i.left,i.top)},moveDown:function(t){var e=this.step.top,i=this.data;i.top=i.top+e,i.top=Math.max(0,Math.min(this.width,i.top)),this.move(t,i.left,i.top)},keyboard:function(e){var i,o=this;return e._keyboard?(i=t.extend(!0,{},e._keyboard),this.$saturation.attr("tabindex","0").on("focus",function(){return i.attach({left:function(){o.moveLeft.call(o,e)},right:function(){o.moveRight.call(o,e)},up:function(){o.moveUp.call(o,e)},down:function(){o.moveDown.call(o,e)}}),!1}).on("blur",function(){i.detach()}),void 0):!1},destroy:function(){t(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}})}(jQuery),function(t){t.colorInput.registerComponent("gradient",{degree:1,count:0,markers:[],current:null,init:function(e){var i=this,o='<a href="#" class="'+e.namespace+'-gradient-trigger">Gradient</a>'+'<div class="'+e.namespace+'-gradient">'+'<div class="'+e.namespace+'-gradient-panel">'+'<div class="'+e.namespace+'-gradient-markers"></div>'+"</div>"+'<div class="'+e.namespace+'-gradient-wheel">'+"<i></i>"+"</div>"+'<input class="'+e.namespace+'-gradient-degree" type="text" value="360" size="3" />'+"</div>";this.api=e,this.classes={show:e.namespace+"-gradient"+"_show",marker:e.namespace+"-gradient-marker"},this.isOpened=!1,this.$doc=t(document),this.$template=t(o).appendTo(e.$picker),this.$trigger=this.$template.eq(0),this.$gradient=this.$template.eq(1),this.$panel=this.$gradient.find("."+e.namespace+"-gradient-markers"),this.$wheel=this.$gradient.find("."+e.namespace+"-gradient-wheel"),this.$pointer=this.$wheel.find("i"),this.$degree=this.$gradient.find("."+e.namespace+"-gradient-degree"),this.$trigger.on("click",function(){return i.isOpened?(i.$gradient.removeClass(i.classes.show),e.isGradient=!1):(i.$gradient.addClass(i.classes.show),e.isGradient=!0),i.isOpened=!i.isOpened,!1}),this.$panel.on("mousedown.colorinput",function(t){var e=t.pageX-i.$panel.offset().left,o=Math.round(100*(e/i.width));return i.makeMarker("#fff",o),!1}),this.$wheel.on("mousedown.colorInput",function(t){return i.wheelMousedown(t),!1}),e.$element.on("colorInput::ready",function(){i.width=i.$panel.width()}),e.$element.on("colorInput::change",function(t,e){i.current&&i.current.setColor(e.color.toRGBA())}),this.$degree.on("blur.colorInput",function(){var t=parseInt(this.value,10);return i.setDegree(t),!1}),this.makeMarker("#fff",0),this.makeMarker("#000",100),this.setDegree(0)},mousedown:function(e,i){var o,s=t(i).data("id");t.each(this.markers,function(t,e){e._id===s&&(o=e)}),this.current=o;var a,n=t(i).position().left,h=e.pageX,r=this.api;return r.makeUnselectable(),r.set(o.color),this.mousemove=function(t){a=t.pageX||h;var e=n+a-h;return this.move(o,e),!1},this.mouseup=function(){return t(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),r.cancelUnselectable(),!1},t(document).on({mousemove:t.proxy(this.mousemove,this),mouseup:t.proxy(this.mouseup,this)}),t(i).focus(),!1},move:function(t,e){this.api,t.$element,e=Math.max(0,Math.min(this.width,e));var i=Math.round(100*(e/this.width));t.setPercent(i),this.makeGradient()},makeMarker:function(e,i){var o=this,s=this.$doc;this.api;var a=function(){this.color=e,this.percent=i,this._id=++o.count,this.$element=t('<span class="'+o.classes.marker+'"><i></i></span>').attr("tabindex",0).data("id",this._id),this.$element.appendTo(o.$panel),this.$element.on("mousedown.colorInput",function(t){var e=t.which?3===t.which:2===t.button;return e?!1:(o.mousedown.call(o,t,this),!1)})};a.prototype.setColor=function(t){this.color=t,this.$element.css({background:t})},a.prototype.setPercent=function(t){this.percent=t,this.$element.css({left:t+"%"})};var n=new a;return n.setPercent(i),n.setColor(e),this.markers.push(n),this.current=n,n.$element.on("focus",function(){s.on("keydown."+n._id,function(t){var e=t.keyCode||t.which;46===e&&o.del(n)})}).on("blur",function(){s.off("keydown."+n._id)}),n},makeGradient:function(){var e=this.markers,i=this.api,o="gradient("+this.degree+"deg,";return e.sort(function(t,e){return t.percent>e.percent}),t.each(e,function(t,e){o+=e.color+" "+e.percent+"%,"}),o=o.substring(0,o.length-1),o+=")",i.gradient=o,i._trigger("gradientChange",o),o},getPosition:function(t,e){var i=this.r,o=t/Math.sqrt(t*t+e*e)*i,s=e/Math.sqrt(t*t+e*e)*i;return{x:o,y:s}},calDegree:function(t,e){var i=Math.round(Math.atan(Math.abs(e/t))*(180/Math.PI));return 0>=t&&e>0?180-i:0>=t&&0>=e?i+180:t>0&&0>=e?360-i:t>0&&e>0?i:void 0},_setDegree:function(t){this.deg=t,this.$degree.val(t),this.makeGradient()},setDegree:function(t){if(this.degree===t)return!1;var e=this.r||this.$wheel.width()/2,i=this.calPointer(t,e);this.$pointer.css({left:i.x,top:i.y}),this._setDegree(t)},calPointer:function(t,e){var i=Math.cos(t*Math.PI/180)*e,o=Math.sin(t*Math.PI/180)*e;return{x:e+i,y:e-o}},wheelMousedown:function(e){var i=this.$wheel.offset(),o=this.$wheel.width()/2,s=i.left+o,a=i.top+o,n=this.$doc;this.r=o,this.wheelMove=function(t){var e=t.pageX-s,i=a-t.pageY,n=this.getPosition(e,i),h=this.calDegree(n.x,n.y);this._setDegree(h);var r=this.calPointer(h,o);this.$pointer.css({left:r.x,top:r.y})},this.wheelMouseup=function(){return n.off({mousemove:this.wheelMove,mouseup:this.wheelMouseup}),!1},n.on({mousemove:t.proxy(this.wheelMove,this),mouseup:t.proxy(this.wheelMouseup,this)}),this.wheelMove(e)},del:function(e){e.$element.remove(),this.markers.splice(t.inArray(e,this.markers),1)},destory:function(){this.$element.off("click"),this.$element.remove()}})}(jQuery);