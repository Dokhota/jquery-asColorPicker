/*! colorInput - v0.1.0 - 2013-10-15
* https://github.com/amazingSurge/jquery-colorInput
* Copyright (c) 2013 amazingSurge; Licensed GPL */
(function(t,o,i,e,s){"use strict";var n="ontouchstart"in t,a=i.colorInput=function(t,o){this.input=t,this.$input=i(t).css({display:"none"}),this.opened=!1,this.enabled=!0,this.isFirstOpen=!0;var s=[];i.each(this.$input.data(),function(t,o){var i=RegExp("^color","i");i.test(t)&&(s[t.toLowerCase().replace(i,"")]=o)}),this.options=i.extend(!0,{},a.defaults,o,s),this.namespace=this.options.namespace,this.hasTouch=n,this.components=i.extend(!0,{},this.components);var h=a.skins[this.options.skin]||"";this._comps=h.split(","),this.color=""===this.input.value?new e({r:255,g:255,b:255,a:1},this.options.format):new e(this.input.value,this.options.format),this.originalColor=this.color.toRGBA(),this.init()};a.prototype={constructor:a,components:{},init:function(){this.$picker=i('<div draggable=false class="'+this.namespace+" "+this.options.skin+' drag-disable"></div>'),this.$input.addClass("colorInput-input"),this.options.flat===!0?(this.create(),this.$input.addClass("colorInput-flat").css({display:"none"}),this.$picker.addClass("colorInput-flat").insertAfter(this.$input).css({position:"relative",top:0,left:0}),this.show()):(this.components.trigger.init(this),this.create(),this.$picker.appendTo("body"),this.$input.on({"focus.colorInput":function(){self.show()},"keydown.colorInput":function(t){9===t.keyCode?self.hide():13===t.keyCode&&(self.color.from(self.$input.val()),self.update({},"input"),self.hide())},"keyup.colorInput":function(){self.color.from(self.$input.val()),self.update({},"input")}})),this.$picker.trigger("colorInput::init",this),"function"===i.type(this.options.onInit)&&this.options.onInit(this)},create:function(){var t=this;i.each(this._comps,function(o,i){t.components[i]&&t.components[i].init(t)}),this.$picker.trigger("colorInput::create")},bindEvent:function(){var e=this;i(o).on("mousedown.colorInput",function(t){return i(t.target).is(e.$input)?s:(e.options.hideFireChange===!1?e.cancel():e.apply(),!1)}),i(t).on("resize.colorInput",i.proxy(this.position,this))},unbindEvent:function(){i(o).off("mousedown.colorInput"),i(t).off("resize.colorInput")},update:function(t,o){var e=this;t!=={}&&e.color.set(t),this.$picker.trigger("colorInput::change",this),"function"===i.type(this.options.onChange)&&this.options.onChange(this),i.each(this._comps,function(t,i){o!==i&&e.components[i]&&e.components[i].update&&e.components[i].update(e)}),"input"!==o&&e.$input.val(""+e.color)},opacity:function(t){return t?(this.update({a:t}),s):this.color.value.a},position:function(){var o,e,s=!this.$input.is(":visible"),n=s?this.$trigger.offset():this.$input.offset(),a=s?this.$trigger.outerHeight():this.$input.outerHeight(),h=s?this.$trigger.outerWidth():this.$input.outerWidth()+this.$trigger.outerWidth(),r=this.$picker.outerWidth(),u=this.$picker.outerHeight();o=u+n.top>i(t).height()+i(t).scrollTop()?n.top-u:n.top+a,e=r+n.left>i(t).width()+i(t).scrollLeft()?n.left-r+h:n.left,this.$picker.css({position:"absolute",top:o,left:e})},show:function(){this.enabled!==!1&&(this.$picker.on("mousedown",function(t){t.stopPropagation()}),this.options.flat===!1&&(this.position(),this.$picker.css({display:"block"}),this.bindEvent()),this.opened=!0,this.$picker.trigger("colorInput::show",this),"function"===i.type(this.options.onChange)&&this.options.onShow(this),this.isFirstOpen=!1)},close:function(){this.options.flat!==!0&&(this.unbindEvent(),this.$picker.css({display:"none"}),this.$input.blur(),this.$picker.trigger("colorInput::close",this),"function"===i.type(this.options.onChange)&&this.options.onClose(this))},cancel:function(){this.color.from(this.originalColor),this.update({}),this.close()},apply:function(){this.originalColor=this.color.toRGBA(),this.close(),this.$picker.trigger("colorInput::apply",this),"function"===i.type(this.options.onApply)&&this.options.onApply(this)},set:function(t){return this.color.from(t),this.update(),this},get:function(t){return t===s?""+this.color:"rgb"===t?this.color.toRGB():"rgba"===t?this.color.toRGBA():"hsl"===t?this.color.toHSL():"hsla"===t?this.color.toHSLA():"hex"===t?this.color.toHEX():s},enable:function(){return this.enabled=!0,this.$parent.addClass(this.namespace+"enabled"),this},disable:function(){return this.enabled=!1,this.$parent.removeClass(this.namespace+"enabled"),this},destroy:function(){}},a.registerComponent=function(t,o){a.prototype.components[t]=o},a.defaults={namespace:"colorInput",readonly:!1,skin:null,flat:!1,showSelected:!1,hideFireChange:!1,onlyBtn:!1,format:"hex",components:{check:{applyText:"apply",cancelText:"cancel"}},onChange:function(t){console.log(t)},onClose:function(){console.log("close")},onShow:function(){console.log("show")}},a.skins={"skin-simple":"palettes","skin-fansion":"saturation,hue,alpha,hex,preview","skin-1":"saturation,Hhue,Halpha,hex,preview,palettes,check","skin-2":"saturation,hue,alpha,hex,preview,check"},a.registerComponent("trigger",{template:'<div class="colorInput-trigger"><span></span></div>',init:function(t){t.$trigger=i(this.template).addClass(t.options.skin),this.$trigger_inner=t.$trigger.children("span"),t.$trigger.insertAfter(t.$input),t.$trigger.on("click",i.proxy(t.show,t)),this.update(t)},update:function(t){this.$trigger_inner.css("backgroundColor",t.color.toRGBA())},destroy:function(t){t.$trigger.remove()}}),i.fn.colorInput=function(t){if("string"==typeof t){var o=t,e=arguments.length>1?Array.prototype.slice.call(arguments,1):s;return this.each(function(){var t=i.data(this,"colorInput");"function"==typeof t[o]&&t[o].apply(t,e)})}return this.each(function(){i.data(this,"colorInput")||i.data(this,"colorInput",new a(this,t))})}})(window,document,jQuery,function(){return void 0===$.colorValue?!1:$.colorValue}()),$.colorInput.registerComponent("Halpha",{selector:".colorInput-alpha",template:'<div class="colorInput-alpha drag-disable"><i class="drag-disable"></i></div>',width:150,data:{},init:function(t){var o=this;this.$alpha=$(this.template).appendTo(t.$picker),this.$handle=this.$alpha.children("i"),this.$alpha.on("mousedown.colorinput",function(i){var e=i.which?3==i.which:2==i.button;return e?!1:($.proxy(o.mousedown,o)(t,i),void 0)}),$(document).on("colorInput::init",function(){o.width=o.$alpha.width(),o.update(t)})},mousedown:function(t,o){var i=this.$alpha.offset();return this.data.startX=o.pageX,this.data.left=o.pageX-i.left,this.move(t,this.data.left),this.mousemove=function(o){var i=this.data.left+(o.pageX||this.data.startX)-this.data.startX;return this.move(t,i),!1},this.mouseup=function(){return $(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),!1},$(document).on({mousemove:$.proxy(this.mousemove,this),mouseup:$.proxy(this.mouseup,this)}),!1},move:function(t,o,i,e){o=Math.max(0,Math.min(this.width,o)),i===void 0&&(i=1-o/this.width),i=Math.max(0,Math.min(1,i)),this.$handle.css({left:o}),e!==!1&&t.update({a:Math.round(100*i)/100},"h-alpha")},update:function(t){var o=this.width*(1-t.color.value.a);this.$alpha.css("backgroundColor",t.color.toHEX()),this.move(t,o,t.color.value.a,!1)},destroy:function(){$(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}}),$.colorInput.registerComponent("Hhue",{selector:".colorInput-picker-hue",template:'<div class="colorInput-hue drag-disable"><i class="drag-disable"></i></div>',width:150,data:{},init:function(t){var o=this;this.$hue=$(this.template).appendTo(t.$picker),this.$handle=this.$hue.children("i"),this.width=this.$hue.width(),this.$hue.on("mousedown.colorInput",function(i){var e=i.which?3==i.which:2==i.button;return e?!1:($.proxy(o.mousedown,o)(t,i),void 0)}),$(document).on("colorInput::init",function(){o.width=o.$hue.width(),o.update(t)})},mousedown:function(t,o){var i=this.$hue.offset();return this.data.startX=o.pageX,this.data.left=o.pageX-i.left,this.move(t,this.data.left),this.mousemove=function(o){var i=this.data.left+(o.pageX||this.data.startX)-this.data.startX;return this.move(t,i),!1},this.mouseup=function(){return $(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),!1},$(document).on({mousemove:$.proxy(this.mousemove,this),mouseup:$.proxy(this.mouseup,this)}),!1},move:function(t,o,i,e){o=Math.max(0,Math.min(this.width,o)),i===void 0&&(i=360*(1-o/this.width)),i=Math.max(0,Math.min(360,i)),this.$handle.css({left:o,background:$.colorValue.HSVtoHEX({h:i,s:1,v:1})}),e!==!1&&t.update({h:i},"h-hue")},update:function(t){var o=0===t.color.value.h?0:this.width*(1-t.color.value.h/360);this.move(t,o,t.color.value.h,!1)},destroy:function(){$(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}}),$.colorInput.registerComponent("alpha",{selector:".colorInput-alpha",template:'<div class="colorInput-alpha drag-disable"><i class="drag-disable"></i></div>',height:150,data:{},init:function(t){var o=this;this.$alpha=$(this.template).appendTo(t.$picker),this.$handle=this.$alpha.children("i"),this.height=this.$alpha.height(),this.$alpha.on("mousedown.colorinput",function(i){var e=i.which?3==i.which:2==i.button;return e?!1:($.proxy(o.mousedown,o)(t,i),void 0)}),$(document).on("colorInput::init",function(){o.height=o.$alpha.height(),o.update(t)})},mousedown:function(t,o){var i=this.$alpha.offset();return this.data.startY=o.pageY,this.data.top=o.pageY-i.top,this.move(t,this.data.top),this.mousemove=function(o){var i=this.data.top+(o.pageY||this.data.startY)-this.data.startY;return this.move(t,i),!1},this.mouseup=function(){return $(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),!1},$(document).on({mousemove:$.proxy(this.mousemove,this),mouseup:$.proxy(this.mouseup,this)}),!1},move:function(t,o,i,e){o=Math.max(0,Math.min(this.height,o)),i===void 0&&(i=1-o/this.height),i=Math.max(0,Math.min(1,i)),this.$handle.css({top:o}),e!==!1&&t.update({a:Math.round(100*i)/100},"alpha")},update:function(t){var o=this.height*(1-t.color.value.a);this.$alpha.css("backgroundColor",t.color.toHEX()),this.move(t,o,t.color.value.a,!1)},destroy:function(){$(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}}),$.colorInput.registerComponent("check",{selector:".colorInput-check",template:'<div class="colorInput-check drag-disable"><a class="colorInput-check-apply drag-disable"></a><a class="colorInput-check-cancel drag-disable"></a></div>',init:function(t){var o=$.extend(this.defaults,t.options.components.check);this.$check=$(this.template).appendTo(t.$picker),this.$apply=this.$check.find(".colorInput-check-apply").text(o.applyText),this.$cancel=this.$check.find(".colorInput-check-cancel").text(o.cancelText),this.$apply.on("click",$.proxy(t.apply,t)),this.$cancel.on("click",$.proxy(t.cancel,t))}}),$.colorInput.registerComponent("hex",{selector:".colorInput-hex",template:'<input type="text" class="colorInput-hex" />',init:function(t){this.$hex=$(this.template).appendTo(t.$picker),this.$hex.on("change",function(){t.set(this.value)}),this.update(t)},update:function(t){this.$hex.val(t.color.toHEX())}}),$.colorInput.registerComponent("hue",{selector:".colorInput-picker-hue",template:'<div class="colorInput-hue drag-disable"><i clsss="drag-disable"></i></div>',height:150,data:{},init:function(t){var o=this;this.$hue=$(this.template).appendTo(t.$picker),this.$handle=this.$hue.children("i"),this.height=this.$hue.height(),this.$hue.on("mousedown.colorInput",function(i){var e=i.which?3==i.which:2==i.button;return e?!1:($.proxy(o.mousedown,o)(t,i),void 0)}),$(document).on("colorInput::init",function(){o.height=o.$hue.height(),o.update(t)})},mousedown:function(t,o){var i=this.$hue.offset();return this.data.startY=o.pageY,this.data.top=o.pageY-i.top,this.move(t,this.data.top),this.mousemove=function(o){o.stopPropagation(),o.preventDefault();var i=this.data.top+(o.pageY||this.data.startY)-this.data.startY;return this.move(t,i),!1},this.mouseup=function(t){return t.stopPropagation(),t.preventDefault(),$(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),!1},$(document).on({mousemove:$.proxy(this.mousemove,this),mouseup:$.proxy(this.mouseup,this)}),!1},move:function(t,o,i,e){o=Math.max(0,Math.min(this.height,o)),i===void 0&&(i=360*(1-o/this.height)),i=Math.max(0,Math.min(360,i)),this.$handle.css({top:o,background:$.colorValue.HSVtoHEX({h:i,s:1,v:1})}),e!==!1&&t.update({h:i},"hue")},update:function(t){var o=0===t.color.value.h?0:this.height*(1-t.color.value.h/360);this.move(t,o,t.color.value.h,!1)},destroy:function(){$(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}}),$.colorInput.registerComponent("info",{selector:".colorInput-info",template:'<ul class="colorInput-info"><li><label>R:<input type="text" data-type="r"/></label></li><li><label>G:<input type="text" data-type="g"/></label></li><li><label>B:<input type="text" data-type="b"/></label></li><li><label>A:<input type="text" data-type="a"/></label></li></ul>',color:["white","black","transparent"],init:function(t){this.$info=$(this.template).appendTo(t.$picker),this.$r=this.$info.find('[data-type="r"]'),this.$g=this.$info.find('[data-type="g"]'),this.$b=this.$info.find('[data-type="b"]'),this.$a=this.$info.find('[data-type="a"]'),this.$info.delegate("input","keyup update change",function(o){var i,e=$(o.target).data("type");switch(e){case"r":case"g":case"b":i=parseInt(this.value,10),i>255?i=255:0>i&&(i=0);break;case"a":i=parseFloat(this.value,10),i>1?i=1:0>i&&(i=0)}isNaN(i)&&(i=0);var s={};s[e]=i,t.value(s)}),this.update(t)},update:function(t){this.$r.val(t.color.value.r),this.$g.val(t.color.value.g),this.$b.val(t.color.value.b),this.$a.val(t.color.value.a)}}),$.colorInput.registerComponent("palettes",{selector:".colorInput-palettes",template:'<div class="colorInput-palettes"></div>',height:150,palettes:{colors:["#fff","#000","#000","#ccc"],max:6},init:function(t){var o="<ul>",i=this,e=$.extend(!0,{},this.palettes,t.options.components.palettes);$.each(e.colors,function(t,i){o+='<li style="background-color:'+i+'" data-color="'+i+'">'+i+"</li>"}),o+="</ul>",this.$list=$(o),this.$palettes=$(this.template).append(this.$list).appendTo(t.$picker),this.$palettes.delegate("li","click",function(o){var e=$(o.target).data("color");i.$list.find("li").removeClass("colorInput-palettes-checked"),$(o.target).addClass("colorInput-palettes-checked"),t.set(e),t.close()}),t.$picker.on("colorInput::apply",function(t,o){-1===e.colors.indexOf(o.originalColor)&&(e.colors.length>=e.max&&(e.colors.shift(),i.$list.find("li").eq(0).remove()),e.colors.push(o.originalColor),i.$list.append('<li style="background-color:'+o.originalColor+'" data-color="'+o.originalColor+'">'+o.originalColor+"</li>"))})}}),$.colorInput.registerComponent("preview",{selector:".colorInput-preview",template:'<div class="colorInput-preview"><span class="colorInput-preview-previous drag-disable"></span><span class="colorInput-preview-current"></span></div>',height:150,init:function(t){var o=this;this.$preview=$(this.template).appendTo(t.$picker),this.$current=this.$preview.find(".colorInput-preview-current"),this.$previous=this.$preview.find(".colorInput-preview-previous"),this.update(t),o.$previous.css("backgroundColor",t.color.toRGBA()),t.$picker.on("colorInput::apply",function(t,i){o.$previous.css("backgroundColor",i.color.toRGBA())})},update:function(t){this.$current.css("backgroundColor",t.color.toRGBA())}}),$.colorInput.registerComponent("saturation",{template:'<div class="colorInput-saturation drag-disable"><i class="drag-disable"><b class="drag-disable"></b></i></div>',defaults:{},options:{},width:0,height:0,size:6,data:{},init:function(t){var o=$.extend(this.defaults,t.options.components.saturation),i=this;this.options=o,this.$saturation=$(this.template).appendTo(t.$picker),this.$handle=this.$saturation.children("i"),this.width=this.$saturation.width(),this.height=this.$saturation.height(),this.size=this.$handle.width()/2,this.$saturation.on("mousedown.colorInput",function(o){var e=o.which?3==o.which:2==o.button;return e?!1:($.proxy(i.mousedown,i)(t,o),void 0)}),$(document).on("colorInput::init",function(){i.width=i.$saturation.width(),i.height=i.$saturation.height(),i.size=i.$handle.width()/2,i.update(t)})},mousedown:function(t,o){var i=this.$saturation.offset();return this.data.startY=o.pageY,this.data.startX=o.pageX,this.data.top=o.pageY-i.top,this.data.left=o.pageX-i.left,this.move(t,this.data.left,this.data.top),this.mousemove=function(o){var i=this.data.left+(o.pageX||this.data.startX)-this.data.startX,e=this.data.top+(o.pageY||this.data.startY)-this.data.startY;return this.move(t,i,e),!1},this.mouseup=function(){return $(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),!1},$(document).on({mousemove:$.proxy(this.mousemove,this),mouseup:$.proxy(this.mouseup,this)}),!1},move:function(t,o,i,e){i=Math.max(0,Math.min(this.height,i)),o=Math.max(0,Math.min(this.width,o)),this.$handle.css({top:i-this.size,left:o-this.size}),e!==!1&&t.update({s:o/this.width,v:1-i/this.height},"saturation")},update:function(t){void 0===t.color.value.h&&(t.color.value.h=0),this.$saturation.css("backgroundColor",$.colorValue.HSLToHEX({h:t.color.value.h,s:1,l:.5}));var o=t.color.value.s*this.width,i=(1-t.color.value.v)*this.height;this.move(t,o,i,!1)},destroy:function(){$(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}});