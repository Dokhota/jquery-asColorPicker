/*! colorInput - v0.1.0 - 2013-07-25
* https://github.com/amazingSurge/jquery-colorInput
* Copyright (c) 2013 amazingSurge; Licensed GPL */
(function(t,e,o,i,s){"use strict";var n="ontouchstart"in t,a=o(e),h=o.colorInput=function(t,e){this.input=t,this.$input=o(t).css({display:"none"}),this.opened=!1,this.enabled=!0;var s=[];o.each(this.$input.data(),function(t,e){var o=RegExp("^color","i");o.test(t)&&(s[t.toLowerCase().replace(o,"")]=e)}),this.options=o.extend(!0,{},h.defaults,e,s),this.namespace=this.options.namespace,this.hasTouch=n,this.components=o.extend(!0,{},this.components);var a=h.skins[this.options.skin]||"";this._comps=a.split(","),this.color=""===this.input.value?new i({r:255,g:255,b:255,a:1},this.options.format):new i(this.input.value,this.options.format),this.originalColor=this.color.toRGBA(),this.init()};h.prototype={constructor:h,components:{},init:function(){this.$picker=o('<div draggable=false class="'+this.namespace+" "+this.options.skin+' drag-disable"></div>'),this.$input.addClass("colorInput-input"),this.options.flat===!0?(this.create(),this.$input.addClass("colorInput-flat").css({display:"none"}),this.$picker.addClass("colorInput-flat").insertAfter(this.$input).css({position:"relative",top:0,left:0}),this.show()):(this.components.trigger.init(this),this.create(),this.$picker.appendTo("body"),this.$input.on({"focus.colorInput":function(){self.show()},"keydown.colorInput":function(t){9===t.keyCode?self.hide():13===t.keyCode&&(self.color.from(self.$input.val()),self.update({},"input"),self.hide())},"keyup.colorInput":function(){self.color.from(self.$input.val()),self.update({},"input")}})),a.trigger("colorInput::init",this)},create:function(){var t=this;o.each(this._comps,function(e,o){t.components[o]&&t.components[o].init(t)}),a.trigger("colorInput::create")},bindEvent:function(){var i=this;o(e).on("mousedown.colorInput",function(t){return o(t.target).is(i.$input)?s:(i.options.hideFireChange===!1?i.cancel():i.apply(),!1)}),o(t).on("resize.colorInput",o.proxy(this.position,this))},unbindEvent:function(){o(e).off("mousedown.colorInput"),o(t).off("resize.colorInput")},update:function(t,e){var i=this;t!=={}&&i.color.set(t),o.each(this._comps,function(t,o){e!==o&&i.components[o]&&i.components[o].update&&i.components[o].update(i)}),"input"!==e&&i.$input.val(""+i.color)},opacity:function(t){return t?(this.update({a:t}),s):this.color.value.a},position:function(){var e,i,s=!this.$input.is(":visible"),n=s?this.$trigger.offset():this.$input.offset(),a=s?this.$trigger.outerHeight():this.$input.outerHeight(),h=s?this.$trigger.outerWidth():this.$input.outerWidth()+this.$trigger.outerWidth(),u=this.$picker.outerWidth(),r=this.$picker.outerHeight();e=r+n.top>o(t).height()+o(t).scrollTop()?n.top-r:n.top+a,i=u+n.left>o(t).width()+o(t).scrollLeft()?n.left-u+h:n.left,this.$picker.css({position:"absolute",top:e,left:i})},show:function(){this.enabled!==!1&&(this.$picker.on("mousedown",function(t){t.stopPropagation()}),this.options.flat===!1&&(this.position(),this.$picker.css({display:"block"}),this.bindEvent()),this.opened=!0,a.trigger("colorInput::show",this))},close:function(){this.options.flat!==!0&&(this.unbindEvent(),this.$picker.css({display:"none"}),this.$input.blur())},cancel:function(){this.color.from(this.originalColor),this.update({}),this.close()},apply:function(){this.originalColor=this.color.toRGBA(),this.close()},set:function(t){return this.color.from(t),this.update(),this},get:function(){return""+this.color},enable:function(){return this.enabled=!0,this.$parent.addClass(this.namespace+"enabled"),this},disable:function(){return this.enabled=!1,this.$parent.removeClass(this.namespace+"enabled"),this},destroy:function(){}},h.registerComponent=function(t,e){h.prototype.components[t]=e},h.defaults={namespace:"colorInput",readonly:!1,skin:"skin-1",flat:!1,showSelected:!1,hideFireChange:!1,onlyBtn:!1,format:"hex",components:{check:{applyText:"apply",cancelText:"cancel"}}},h.skins={"skin-simple":"palettes","skin-fansion":"saturation,hue,alpha,hex,preview","skin-1":"saturation,Hhue,Halpha,hex,preview,palettes,check","skin-2":"saturation,hue,alpha,hex,preview,check"},h.registerComponent("trigger",{template:'<div class="colorInput-trigger"><span></span></div>',init:function(t){t.$trigger=o(this.template).addClass(t.options.skin),this.$trigger_inner=t.$trigger.children("span"),t.$trigger.insertAfter(t.$input),t.$trigger.on("click",o.proxy(t.show,t)),this.update(t)},update:function(t){this.$trigger_inner.css("backgroundColor",t.color.toRGBA())},destroy:function(t){t.$trigger.remove()}}),o.fn.colorInput=function(t){if("string"==typeof t){var e=t,i=arguments.length>1?Array.prototype.slice.call(arguments,1):s;return this.each(function(){var t=o.data(this,"colorInput");"function"==typeof t[e]&&t[e].apply(t,i)})}return this.each(function(){o.data(this,"colorInput")||o.data(this,"colorInput",new h(this,t))})}})(window,document,jQuery,function(){return void 0===$.colorValue?!1:$.colorValue}()),$.colorInput.registerComponent("Halpha",{selector:".colorInput-alpha",template:'<div class="colorInput-alpha drag-disable"><i class="drag-disable"></i></div>',width:150,data:{},init:function(t){var e=this;this.$alpha=$(this.template).appendTo(t.$picker),this.$handle=this.$alpha.children("i"),this.$alpha.on("mousedown.colorinput",function(o){var i=o.which?3==o.which:2==o.button;return i?!1:($.proxy(e.mousedown,e)(t,o),void 0)}),$(document).on("colorInput::init",function(){e.width=e.$alpha.width(),e.update(t)})},mousedown:function(t,e){var o=this.$alpha.offset();return this.data.startX=e.pageX,this.data.left=e.pageX-o.left,this.move(t,this.data.left),this.mousemove=function(e){var o=this.data.left+(e.pageX||this.data.startX)-this.data.startX;return this.move(t,o),!1},this.mouseup=function(){return $(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),!1},$(document).on({mousemove:$.proxy(this.mousemove,this),mouseup:$.proxy(this.mouseup,this)}),!1},move:function(t,e,o,i){e=Math.max(0,Math.min(this.width,e)),o===void 0&&(o=1-e/this.width),o=Math.max(0,Math.min(1,o)),this.$handle.css({left:e}),i!==!1&&t.update({a:Math.round(100*o)/100},"h-alpha")},update:function(t){var e=this.width*(1-t.color.value.a);this.$alpha.css("backgroundColor",t.color.toHEX()),this.move(t,e,t.color.value.a,!1)},destroy:function(){$(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}}),$.colorInput.registerComponent("Hhue",{selector:".colorInput-picker-hue",template:'<div class="colorInput-hue drag-disable"><i class="drag-disable"></i></div>',width:150,data:{},init:function(t){var e=this;this.$hue=$(this.template).appendTo(t.$picker),this.$handle=this.$hue.children("i"),this.width=this.$hue.width(),this.$hue.on("mousedown.colorInput",function(o){var i=o.which?3==o.which:2==o.button;return i?!1:($.proxy(e.mousedown,e)(t,o),void 0)}),$(document).on("colorInput::init",function(){e.width=e.$hue.width(),e.update(t)})},mousedown:function(t,e){var o=this.$hue.offset();return this.data.startX=e.pageX,this.data.left=e.pageX-o.left,this.move(t,this.data.left),this.mousemove=function(e){var o=this.data.left+(e.pageX||this.data.startX)-this.data.startX;return this.move(t,o),!1},this.mouseup=function(){return $(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),!1},$(document).on({mousemove:$.proxy(this.mousemove,this),mouseup:$.proxy(this.mouseup,this)}),!1},move:function(t,e,o,i){e=Math.max(0,Math.min(this.width,e)),o===void 0&&(o=360*(1-e/this.width)),o=Math.max(0,Math.min(360,o)),this.$handle.css({left:e,background:$.colorValue.HSVtoHEX({h:o,s:1,v:1})}),i!==!1&&t.update({h:o},"h-hue")},update:function(t){var e=0===t.color.value.h?0:this.width*(1-t.color.value.h/360);this.move(t,e,t.color.value.h,!1)},destroy:function(){$(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}}),$.colorInput.registerComponent("alpha",{selector:".colorInput-alpha",template:'<div class="colorInput-alpha drag-disable"><i class="drag-disable"></i></div>',height:150,data:{},init:function(t){var e=this;this.$alpha=$(this.template).appendTo(t.$picker),this.$handle=this.$alpha.children("i"),this.height=this.$alpha.height(),this.$alpha.on("mousedown.colorinput",function(o){var i=o.which?3==o.which:2==o.button;return i?!1:($.proxy(e.mousedown,e)(t,o),void 0)}),$(document).on("colorInput::init",function(){e.height=e.$alpha.height(),e.update(t)})},mousedown:function(t,e){var o=this.$alpha.offset();return this.data.startY=e.pageY,this.data.top=e.pageY-o.top,this.move(t,this.data.top),this.mousemove=function(e){var o=this.data.top+(e.pageY||this.data.startY)-this.data.startY;return this.move(t,o),!1},this.mouseup=function(){return $(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),!1},$(document).on({mousemove:$.proxy(this.mousemove,this),mouseup:$.proxy(this.mouseup,this)}),!1},move:function(t,e,o,i){e=Math.max(0,Math.min(this.height,e)),o===void 0&&(o=1-e/this.height),o=Math.max(0,Math.min(1,o)),this.$handle.css({top:e}),i!==!1&&t.update({a:Math.round(100*o)/100},"alpha")},update:function(t){var e=this.height*(1-t.color.value.a);this.$alpha.css("backgroundColor",t.color.toHEX()),this.move(t,e,t.color.value.a,!1)},destroy:function(){$(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}}),$.colorInput.registerComponent("check",{selector:".colorInput-check",template:'<div class="colorInput-check drag-disable"><a class="colorInput-check-apply drag-disable"></a><a class="colorInput-check-cancel drag-disable"></a></div>',init:function(t){var e=$.extend(this.defaults,t.options.components.check);this.$check=$(this.template).appendTo(t.$picker),this.$apply=this.$check.find(".colorInput-check-apply").text(e.applyText),this.$cancel=this.$check.find(".colorInput-check-cancel").text(e.cancelText),this.$apply.on("click",$.proxy(t.apply,t)),this.$cancel.on("click",$.proxy(t.cancel,t))}}),$.colorInput.registerComponent("hex",{selector:".colorInput-hex",template:'<input type="text" class="colorInput-hex" />',init:function(t){this.$hex=$(this.template).appendTo(t.$picker),this.$hex.on("change",function(){t.set(this.value)}),this.update(t)},update:function(t){this.$hex.val(t.color.toHEX())}}),$.colorInput.registerComponent("hue",{selector:".colorInput-picker-hue",template:'<div class="colorInput-hue drag-disable"><i clsss="drag-disable"></i></div>',height:150,data:{},init:function(t){var e=this;this.$hue=$(this.template).appendTo(t.$picker),this.$handle=this.$hue.children("i"),this.height=this.$hue.height(),this.$hue.on("mousedown.colorInput",function(o){var i=o.which?3==o.which:2==o.button;return i?!1:($.proxy(e.mousedown,e)(t,o),void 0)}),$(document).on("colorInput::init",function(){e.height=e.$hue.height(),e.update(t)})},mousedown:function(t,e){var o=this.$hue.offset();return this.data.startY=e.pageY,this.data.top=e.pageY-o.top,this.move(t,this.data.top),this.mousemove=function(e){e.stopPropagation(),e.preventDefault();var o=this.data.top+(e.pageY||this.data.startY)-this.data.startY;return this.move(t,o),!1},this.mouseup=function(t){return t.stopPropagation(),t.preventDefault(),$(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),!1},$(document).on({mousemove:$.proxy(this.mousemove,this),mouseup:$.proxy(this.mouseup,this)}),!1},move:function(t,e,o,i){e=Math.max(0,Math.min(this.height,e)),o===void 0&&(o=360*(1-e/this.height)),o=Math.max(0,Math.min(360,o)),this.$handle.css({top:e,background:$.colorValue.HSVtoHEX({h:o,s:1,v:1})}),i!==!1&&t.update({h:o},"hue")},update:function(t){var e=0===t.color.value.h?0:this.height*(1-t.color.value.h/360);this.move(t,e,t.color.value.h,!1)},destroy:function(){$(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}}),$.colorInput.registerComponent("info",{selector:".colorInput-info",template:'<ul class="colorInput-info"><li><label>R:<input type="text" data-type="r"/></label></li><li><label>G:<input type="text" data-type="g"/></label></li><li><label>B:<input type="text" data-type="b"/></label></li><li><label>A:<input type="text" data-type="a"/></label></li></ul>',color:["white","black","transparent"],init:function(t){this.$info=$(this.template).appendTo(t.$picker),this.$r=this.$info.find('[data-type="r"]'),this.$g=this.$info.find('[data-type="g"]'),this.$b=this.$info.find('[data-type="b"]'),this.$a=this.$info.find('[data-type="a"]'),this.$info.delegate("input","keyup update change",function(e){var o,i=$(e.target).data("type");switch(i){case"r":case"g":case"b":o=parseInt(this.value,10),o>255?o=255:0>o&&(o=0);break;case"a":o=parseFloat(this.value,10),o>1?o=1:0>o&&(o=0)}isNaN(o)&&(o=0);var s={};s[i]=o,t.value(s)}),this.update(t)},update:function(t){this.$r.val(t.color.value.r),this.$g.val(t.color.value.g),this.$b.val(t.color.value.b),this.$a.val(t.color.value.a)}}),$.colorInput.registerComponent("palettes",{selector:".colorInput-palettes",template:'<div class="colorInput-palettes"></div>',height:150,colors:{white:"#fff",black:"#000",a:"#555",b:"#ccc"},init:function(t){var e="<ul>",o=this,i=$.extend(!0,{},this.colors,t.options.components.palettes);$.each(this.colors,function(t,o){e+='<li style="background-color:'+o+'" data-color="'+t+'">'+t+"</li>"}),e+="</ul>",this.$palettes=$(this.template).append($(e)).appendTo(t.$picker),this.$palettes.delegate("li","click",function(e){var s=$(e.target).data("color");o.$palettes.find("li").removeClass("colorInput-palettes-checked"),$(e.target).addClass("checked"),t.set(i[s]),t.close()})}}),$.colorInput.registerComponent("preview",{selector:".colorInput-preview",template:'<div class="colorInput-preview"><span class="colorInput-preview-previous drag-disable"></span><span class="colorInput-preview-current"></span></div>',height:150,init:function(t){this.$preview=$(this.template).appendTo(t.$picker),this.$current=this.$preview.find(".colorInput-preview-current"),this.update(t)},update:function(t){this.$current.css("backgroundColor",t.color.toRGBA())}}),$.colorInput.registerComponent("saturation",{template:'<div class="colorInput-saturation drag-disable"><i class="drag-disable"><b class="drag-disable"></b></i></div>',defaults:{},options:{},width:0,height:0,size:6,data:{},init:function(t){var e=$.extend(this.defaults,t.options.components.saturation),o=this;this.options=e,this.$saturation=$(this.template).appendTo(t.$picker),this.$handle=this.$saturation.children("i"),this.width=this.$saturation.width(),this.height=this.$saturation.height(),this.size=this.$handle.width()/2,this.$saturation.on("mousedown.colorInput",function(e){var i=e.which?3==e.which:2==e.button;return i?!1:($.proxy(o.mousedown,o)(t,e),void 0)}),$(document).on("colorInput::init",function(){o.width=o.$saturation.width(),o.height=o.$saturation.height(),o.size=o.$handle.width()/2,o.update(t)})},mousedown:function(t,e){var o=this.$saturation.offset();return this.data.startY=e.pageY,this.data.startX=e.pageX,this.data.top=e.pageY-o.top,this.data.left=e.pageX-o.left,this.move(t,this.data.left,this.data.top),this.mousemove=function(e){var o=this.data.left+(e.pageX||this.data.startX)-this.data.startX,i=this.data.top+(e.pageY||this.data.startY)-this.data.startY;return this.move(t,o,i),!1},this.mouseup=function(){return $(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),!1},$(document).on({mousemove:$.proxy(this.mousemove,this),mouseup:$.proxy(this.mouseup,this)}),!1},move:function(t,e,o,i){o=Math.max(0,Math.min(this.height,o)),e=Math.max(0,Math.min(this.width,e)),this.$handle.css({top:o-this.size,left:e-this.size}),i!==!1&&t.update({s:e/this.width,v:1-o/this.height},"saturation")},update:function(t){void 0===t.color.value.h&&(t.color.value.h=0),this.$saturation.css("backgroundColor",$.colorValue.HSLToHEX({h:t.color.value.h,s:1,l:.5}));var e=t.color.value.s*this.width,o=(1-t.color.value.v)*this.height;this.move(t,e,o,!1)},destroy:function(){$(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}});