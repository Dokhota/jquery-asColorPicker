/*! asColorInput - v0.1.3 - 2014-06-25
* https://github.com/amazingSurge/jquery-asColorInput
* Copyright (c) 2014 amazingSurge; Licensed GPL */
!function(a,b,c,d,e){"use strict";function f(a){a.id=g,g++}var g=0,h=(!!/msie/i.exec(a.navigator.userAgent),c.asColorInput=function(a,b){this.element=a,this.$element=c(a),this.opened=!1,this.firstOpen=!0,this.disabled=!1,this.clear=!1,f(this),this.options=c.extend(!0,{},h.defaults,b,this.$element.data()),this.namespace=this.options.namespace,this.classes={wrap:this.namespace+"-wrap",dropdown:this.namespace+"-dropdown",input:this.namespace+"-input",clear:this.namespace+"-clear",skin:this.namespace+"_"+this.options.skin,open:this.namespace+"_open",mask:this.namespace+"-mask",hideInput:this.namespace+"_hideInput",disabled:this.namespace+"_disabled",mode:this.namespace+"-mode_"+this.options.mode},this.components=c.extend(!0,{},this.components),this._comps=h.modes[this.options.mode],""===this.element.value?this.color=new d({r:255,g:255,b:255,a:1},this.options.format):("gradient"===this.options.mode&&(this.gradient=this.element.value),this.color=new d(this.element.value,this.options.format)),this.options.hideInput&&this.$element.addClass(this.classes.hideInput),this.updateInput(),this.originalColor=this.color.toRGBA(),this._trigger("init"),this.init()});h.prototype={constructor:h,components:{},init:function(){var a=this;this.$dropdown=c('<div class="'+this.classes.dropdown+'" data-mode="'+this.options.mode+'"></div>'),this.$element.wrap('<div class="'+this.classes.wrap+'"></div>').addClass(this.classes.input),this.$clear=c('<a href="#" class="'+this.classes.clear+'">x</a>').insertAfter(this.$element),this.$wrap=this.$element.parent(),this.$body=c("body"),this.$dropdown.data("asColorInput",this),this.options.skin&&(this.$dropdown.addClass(this.classes.skin),this.$element.parent().addClass(this.classes.skin)),this.create(),this.options.readonly&&this.$element.prop("readonly",!0),this.$element.on({"click.asColorInput":function(){return a.opened||a.open(),!1},"keydown.asColorInput":function(b){a.isGradient||(9===b.keyCode?a.close():13===b.keyCode&&(a.color.from(a.$element.val()),a.update({},"input"),a.close()))},"keyup.asColorInput":function(){a.isGradient||(a.color.from(a.$element.val()),a.update({},"input"))}}),this.$clear.on("click",function(){return a.clear=!0,a.color.from("transparent"),a.update({}),a.$element.val(""),a.clear=!1,!1}),this._trigger("ready")},create:function(){var a=this;this.components.trigger.init(this),c.each(this._comps,function(b,d){d===!0&&(d={}),a.options.components[b]!==e&&(d=c.extend(d,a.options.components[b])),a.components[b]&&a.components[b].init(a,d)}),this._trigger("create")},_trigger:function(a){this.$element.trigger("asColorInput::"+a,this),this.$element.trigger(a+".asColorInput",this),a=a.replace(/\b\w+\b/g,function(a){return a.substring(0,1).toUpperCase()+a.substring(1)});var b="on"+a,c=arguments.length>1?Array.prototype.slice.call(arguments,1):e;"function"==typeof this.options[b]&&this.options[b].apply(this,c)},update:function(a,b){var d=this;a!=={}&&d.color.set(a),this._trigger("change",a),c.each(this._comps,function(a){b!==a&&d.components[a]&&d.components[a].update&&d.components[a].update(d)}),this.components.trigger.update(this),"input"!==b&&(this.isGradient||this.updateInput())},updateInput:function(){var a=this.options.format;if(a){if(this.options.reduceAlpha&&1===this.color.value.a)switch(a){case"rgba":a="rgb";break;case"hsla":a="hsl"}this.$element.val(this.get(a))}else this.$element.val(this.color.toString())},opacity:function(a){return a?void this.update({a:a}):this.color.value.a},position:function(){var b,d,e=!this.$element.is(":visible"),f=e?this.$trigger.offset():this.$element.offset(),g=e?this.$trigger.outerHeight():this.$element.outerHeight(),h=e?this.$trigger.outerWidth():this.$element.outerWidth()+this.$trigger.outerWidth(),i=this.$dropdown.outerWidth(!0),j=this.$dropdown.outerHeight(!0);b=j+f.top>c(a).height()+c(a).scrollTop()?f.top-j:f.top+g,d=i+f.left>c(a).width()+c(a).scrollLeft()?f.left-i+h:f.left,this.$dropdown.css({position:"absolute",top:b,left:d})},open:function(){if(!this.disabled){var b=this;this.$dropdown[0]!==this.$body.children().last()[0]&&this.$dropdown.detach().appendTo(this.$body),this.$mask=c("."+b.classes.mask),0==this.$mask.length&&this.createMask(),this.$dropdown.prev()[0]!==this.$mask[0]&&this.$dropdown.before(this.$mask),c("#asColorInput-dropdown").removeAttr("id"),this.$dropdown.attr("id","asColorInput-dropdown"),this.$mask.show(),this.position(),c(a).on("resize.asColorInput",c.proxy(this.position,this)),this.$dropdown.addClass(this.classes.open),this.opened=!0,this.firstOpen&&(this.firstOpen=!1,this._trigger("firstOpen")),this._trigger("open")}},createMask:function(){this.$mask=c(b.createElement("div")),this.$mask.attr("class",this.classes.mask),this.$mask.hide(),this.$mask.appendTo(this.$body);this.$mask.on("mousedown touchstart click",function(a){var b,d=c("#asColorInput-dropdown");d.length>0&&(b=d.data("asColorInput"),b.opened&&(b.options.hideFireChange?b.apply():b.cancel()),a.preventDefault(),a.stopPropagation())})},close:function(){this.opened=!1,this.$element.blur(),this.$mask.hide(),this.$dropdown.removeClass(this.classes.open),c(a).off("resize.asColorInput"),this._trigger("close")},clear:function(){this.color.from("#fff"),this.update({}),this.close()},cancel:function(){return this.color.from(this.originalColor),this.update({}),this.close(),!1},apply:function(){return this.originalColor=this.color.toRGBA(),this.close(),this._trigger("apply"),!1},set:function(a){return this.color.from(a),this.update(),this},get:function(a){return a===e?this.color.toString():"rgb"===a?this.color.toRGB():"rgba"===a?this.color.toRGBA():"hsl"===a?this.color.toHSL():"hsla"===a?this.color.toHSLA():"hex"===a?this.color.toHEX():void 0},enable:function(){return this.disabled=!1,this.$parent.addClass(this.classes.disabled),this},disable:function(){return this.disabled=!0,this.$parent.removeClass(this.classes.disabled),this},destroy:function(){}},h.registerComponent=function(a,b){h.prototype.components[a]=b},h.localization=[],h.defaults={namespace:"asColorInput",readonly:!1,skin:null,hideInput:!1,hideFireChange:!0,keyboard:!1,format:"rgba",reduceAlpha:!0,mode:"simple",components:{},onInit:null,onReady:null,onChange:null,onClose:null,onOpen:null,onApply:null},h.modes={simple:{saturation:!0,hue:!0,alpha:!0},palettes:{palettes:!0},complex:{preview:!0,palettes:!0,saturation:!0,hue:!0,alpha:!0,hex:!0,buttons:!0},gradient:{preview:!0,palettes:!0,saturation:!0,hue:!0,alpha:!0,hex:!0,gradient:!0}},h.registerComponent("trigger",{template:'<div class="asColorInput-trigger"><span></span></div>',init:function(a){var b='<div class="'+a.namespace+'-trigger"><span></span></div>';a.$trigger=c(b),this.$trigger_inner=a.$trigger.children("span"),a.$trigger.insertAfter(a.$element),a.$trigger.on("click",function(){return a.opened?a.close():a.open(),!1}),this.update(a)},update:function(a){a.isGradient?(this.$trigger_inner.css("backgroundColor","transparent"),this.$trigger_inner[0].style.backgroundImage=a.gradient):(this.$trigger_inner[0].style.backgroundImage="",this.$trigger_inner.css("backgroundColor",a.color.toRGBA()))},destroy:function(a){a.$trigger.remove()}}),c.fn.asColorInput=function(a){if("string"==typeof a){var b=a,d=arguments.length>1?Array.prototype.slice.call(arguments,1):e;return this.each(function(){var a=c.data(this,"asColorInput");"function"==typeof a[b]&&a[b].apply(a,d)})}return this.each(function(){c.data(this,"asColorInput")||c.data(this,"asColorInput",new h(this,a))})}}(window,document,jQuery,function(a){return void 0===a.asColor?!1:a.asColor}(jQuery)),function(a,b,c){var d=c(b),e={keys:{UP:38,DOWN:40,LEFT:37,RIGHT:39,RETURN:13,ESCAPE:27,BACKSPACE:8,SPACE:32},map:{},bound:!1,press:function(a){var b=a.keyCode||a.which;return b in e.map&&"function"==typeof e.map[b]&&e.map[b](a),!1},attach:function(a){var b,c;for(b in a)a.hasOwnProperty(b)&&(c=b.toUpperCase(),c in e.keys?e.map[e.keys[c]]=a[b]:e.map[c]=a[b]);e.bound||(e.bound=!0,d.bind("keydown",e.press))},detach:function(){e.bound=!1,e.map={},d.unbind("keydown",e.press)}};d.on("asColorInput::init",function(a,b){b.options.keyboard===!0&&(b._keyboard=e)})}(window,document,jQuery),function(a){a.asColorInput.registerComponent("alpha",{size:150,defaults:{direction:"vertical"},data:{},init:function(b,c){var d=this;this.options=a.extend(this.defaults,c),d.direction=this.options.direction,this.$alpha=a('<div class="'+b.namespace+"-alpha "+b.namespace+"-alpha-"+this.direction+'"><i></i></div>').appendTo(b.$dropdown),this.$handle=this.$alpha.children("i"),b.$element.on("asColorInput::firstOpen",function(){d.size="vertical"===d.direction?d.$alpha.height():d.$alpha.width(),d.step=d.size/360,d.update(b),d.bindEvents(b),d.keyboard(b)})},bindEvents:function(b){var c=this;this.$alpha.on("mousedown.asColorInput",function(d){var e=d.which?3===d.which:2===d.button;return e?!1:void a.proxy(c.mousedown,c)(b,d)})},mousedown:function(b,c){var d=this.$alpha.offset();return"vertical"===this.direction?(this.data.startY=c.pageY,this.data.top=c.pageY-d.top,this.move(b,this.data.top)):(this.data.startX=c.pageX,this.data.left=c.pageX-d.left,this.move(b,this.data.left)),this.mousemove=function(a){var c;return c="vertical"===this.direction?this.data.top+(a.pageY||this.data.startY)-this.data.startY:this.data.left+(a.pageX||this.data.startX)-this.data.startX,this.move(b,c),!1},this.mouseup=function(){return a(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),"vertical"===this.direction?this.data.top=this.data.cach:this.data.left=this.data.cach,!1},a(document).on({mousemove:a.proxy(this.mousemove,this),mouseup:a.proxy(this.mouseup,this)}),!1},move:function(a,b,c,d){b=Math.max(0,Math.min(this.size,b)),this.data.cach=b,"undefined"==typeof c&&(c=1-b/this.size),c=Math.max(0,Math.min(1,c)),this.$handle.css("vertical"===this.direction?{top:b}:{left:b}),d!==!1&&a.update({a:Math.round(100*c)/100},"alpha")},moveLeft:function(a){var b=this.step,c=this.data;c.left=Math.max(0,Math.min(this.width,c.left-b)),this.move(a,c.left)},moveRight:function(a){var b=this.step,c=this.data;c.left=Math.max(0,Math.min(this.width,c.left+b)),this.move(a,c.left)},moveUp:function(a){var b=this.step,c=this.data;c.top=Math.max(0,Math.min(this.width,c.top-b)),this.move(a,c.top)},moveDown:function(a){var b=this.step,c=this.data;c.top=Math.max(0,Math.min(this.width,c.top+b)),this.move(a,c.top)},keyboard:function(b){var c,d=this;return b._keyboard?(c=a.extend(!0,{},b._keyboard),void this.$alpha.attr("tabindex","0").on("focus",function(){return c.attach("vertical"===this.direction?{up:function(){d.moveUp.call(d,b)},down:function(){d.moveDown.call(d,b)}}:{left:function(){d.moveLeft.call(d,b)},right:function(){d.moveRight.call(d,b)}}),!1}).on("blur",function(){c.detach()})):!1},update:function(a){var b=this.size*(1-a.color.value.a);this.$alpha.css("backgroundColor",a.color.toHEX()),this.move(a,b,a.color.value.a,!1)},destroy:function(){a(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}})}(jQuery),function(a){a.asColorInput.registerComponent("buttons",{defaults:{apply:!1,cancel:!0,applyText:"apply",cancelText:"cancel"},init:function(b,c){var d=this;this.options=a.extend(this.defaults,c),this.$buttons=a('<div class="'+b.namespace+'-buttons"></div>').appendTo(b.$dropdown),b.$element.on("asColorInput::firstOpen",function(){d.options.apply&&(d.$apply=a('<a href="#" alt="'+d.options.applyText+'" class="'+b.namespace+'-buttons-apply"></a>').text(d.options.applyText).appendTo(d.$buttons).on("click",a.proxy(b.apply,b))),d.options.cancel&&(d.$cancel=a('<a href="#" alt="'+d.options.cancelText+'" class="'+b.namespace+'-buttons-cancel"></a>').text(d.options.cancelText).appendTo(d.$buttons).on("click",a.proxy(b.cancel,b)))})}})}(jQuery),function(a){a.asColorInput.registerComponent("hex",{init:function(b){var c='<input type="text" class="'+b.namespace+'-hex" />';this.$hex=a(c).appendTo(b.$dropdown),this.$hex.on("change",function(){b.set(this.value)}),this.update(b)},update:function(a){this.$hex.val(a.color.toHEX())}})}(jQuery),function(a){a.asColorInput.registerComponent("hue",{size:150,defaults:{direction:"vertical"},data:{},init:function(b,c){var d=this;this.options=a.extend(this.defaults,c),this.direction=this.options.direction,this.$hue=a('<div class="'+b.namespace+"-hue "+b.namespace+"-hue-"+this.direction+'"><i></i></div>').appendTo(b.$dropdown),this.$handle=this.$hue.children("i"),b.$element.on("asColorInput::firstOpen",function(){d.size="vertical"===d.direction?d.$hue.height():d.$hue.width(),d.step=d.size/360,d.update(b),d.bindEvents(b),d.keyboard(b)})},bindEvents:function(b){var c=this;this.$hue.on("mousedown.asColorInput",function(d){var e=d.which?3===d.which:2===d.button;return e?!1:void a.proxy(c.mousedown,c)(b,d)})},mousedown:function(b,c){var d=this.$hue.offset();return"vertical"===this.direction?(this.data.startY=c.pageY,this.data.top=c.pageY-d.top,this.move(b,this.data.top)):(this.data.startX=c.pageX,this.data.left=c.pageX-d.left,this.move(b,this.data.left)),this.mousemove=function(a){var c;return c="vertical"===this.direction?this.data.top+(a.pageY||this.data.startY)-this.data.startY:this.data.left+(a.pageX||this.data.startX)-this.data.startX,this.move(b,c),!1},this.mouseup=function(){return a(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),"vertical"===this.direction?this.data.top=this.data.cach:this.data.left=this.data.cach,!1},a(document).on({mousemove:a.proxy(this.mousemove,this),mouseup:a.proxy(this.mouseup,this)}),!1},move:function(a,b,c,d){b=Math.max(0,Math.min(this.size,b)),this.data.cach=b,"undefined"==typeof c&&(c=360*(1-b/this.size)),c=Math.max(0,Math.min(360,c)),this.$handle.css("vertical"===this.direction?{top:b}:{left:b}),d!==!1&&a.update({h:c},"hue")},moveLeft:function(a){var b=this.step,c=this.data;c.left=Math.max(0,Math.min(this.width,c.left-b)),this.move(a,c.left)},moveRight:function(a){var b=this.step,c=this.data;c.left=Math.max(0,Math.min(this.width,c.left+b)),this.move(a,c.left)},moveUp:function(a){var b=this.step,c=this.data;c.top=Math.max(0,Math.min(this.width,c.top-b)),this.move(a,c.top)},moveDown:function(a){var b=this.step,c=this.data;c.top=Math.max(0,Math.min(this.width,c.top+b)),this.move(a,c.top)},keyboard:function(b){var c,d=this;return b._keyboard?(c=a.extend(!0,{},b._keyboard),void this.$hue.attr("tabindex","0").on("focus",function(){return c.attach("vertical"===this.direction?{up:function(){d.moveUp.call(d,b)},down:function(){d.moveDown.call(d,b)}}:{left:function(){d.moveLeft.call(d,b)},right:function(){d.moveRight.call(d,b)}}),!1}).on("blur",function(){c.detach()})):!1},update:function(a){var b=0===a.color.value.h?0:this.size*(1-a.color.value.h/360);this.move(a,b,a.color.value.h,!1)},destroy:function(){a(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}})}(jQuery),function(a){a.asColorInput.registerComponent("info",{color:["white","black","transparent"],init:function(b){var c='<ul class="'+b.namespace+'-info"><li><label>R:<input type="text" data-type="r"/></label></li><li><label>G:<input type="text" data-type="g"/></label></li><li><label>B:<input type="text" data-type="b"/></label></li><li><label>A:<input type="text" data-type="a"/></label></li></ul>';this.$info=a(c).appendTo(b.$dropdown),this.$r=this.$info.find('[data-type="r"]'),this.$g=this.$info.find('[data-type="g"]'),this.$b=this.$info.find('[data-type="b"]'),this.$a=this.$info.find('[data-type="a"]'),this.$info.delegate("input","keyup update change",function(c){var d,e=a(c.target).data("type");switch(e){case"r":case"g":case"b":d=parseInt(this.value,10),d>255?d=255:0>d&&(d=0);break;case"a":d=parseFloat(this.value,10),d>1?d=1:0>d&&(d=0)}isNaN(d)&&(d=0);var f={};f[e]=d,b.value(f)}),this.update(b)},update:function(a){this.$r.val(a.color.value.r),this.$g.val(a.color.value.g),this.$b.val(a.color.value.b),this.$a.val(a.color.value.a)}})}(jQuery),function(a){function b(){}window.localStorage||(window.localStorage=b),a.asColorInput.registerComponent("palettes",{defaults:{colors:["#fff","#ffff00","#f00","#0f0","#0ff","#000"],max:10,localStorage:!0},init:function(b,c){var d=this;if(this.options=a.extend(!0,{},this.defaults,c),this.options.localStorage){var e=b.namespace+"_palettes_"+b.id,f=this.getLocalItem(e);f&&(this.options.colors=f)}var g="";a.each(this.options.colors,function(a,b){g+=d.getItem(b)}),this.$palettes=a('<ul class="'+b.namespace+'-palettes"></ul>').html(g).appendTo(b.$dropdown),this.$palettes.delegate("li","click",function(c){var d=a(this).data("color");b.set(d),c.preventDefault(),c.stopPropagation()}),b.$element.on("asColorInput::apply",function(a,b){-1===d.options.colors.indexOf(b.originalColor)&&(d.options.colors.length>=d.options.max&&(d.options.colors.shift(),d.$palettes.find("li").eq(0).remove()),d.options.colors.push(b.originalColor),d.$palettes.append(d.getItem(b.originalColor)),d.options.localStorage&&d.setLocalItem(e,d.options.colors))})},getItem:function(a){return'<li data-color="'+a+'"><div style="background-color:'+a+'" /></li>'},setLocalItem:function(a,b){var c=JSON.stringify(b);localStorage[a]=c},getLocalItem:function(a){var b=localStorage[a];return b?JSON.parse(b):b}})}(jQuery),function(a){a.asColorInput.registerComponent("preview",{init:function(b){var c=this,d='<ul class="'+b.namespace+'-preview"><li class="'+b.namespace+'-preview-current"><div /></li><li class="'+b.namespace+'-preview-previous"><div /></li></ul>';this.$preview=a(d).appendTo(b.$dropdown),this.$current=this.$preview.find("."+b.namespace+"-preview-current div"),this.$previous=this.$preview.find("."+b.namespace+"-preview-previous div"),b.$element.on("asColorInput::firstOpen",function(){c.update(b),c.$previous.css("backgroundColor",b.color.toRGBA()),b.$element.on("asColorInput::apply",function(a,b){c.$previous.css("backgroundColor",b.color.toRGBA())}),c.$previous.on("click",function(){return b.set(b.originalColor),!1})})},update:function(a){this.$current.css("backgroundColor",a.color.toRGBA())}})}(jQuery),function(a){a.asColorInput.registerComponent("saturation",{defaults:{},width:0,height:0,size:6,data:{},init:function(b,c){var d=this,e='<div class="'+b.namespace+'-saturation"><i><b></b></i></div>';this.options=a.extend(this.defaults,c),this.$saturation=a(e).appendTo(b.$dropdown),this.$handle=this.$saturation.children("i"),b.$element.on("asColorInput::firstOpen",function(){d.width=d.$saturation.width(),d.height=d.$saturation.height(),d.step={left:d.width/20,top:d.height/20},d.size=d.$handle.width()/2,d.update(b),d.bindEvents(b),d.keyboard(b)})},bindEvents:function(b){var c=this;this.$saturation.on("mousedown.asColorInput",function(d){var e=d.which?3===d.which:2===d.button;return e?!1:void a.proxy(c.mousedown,c)(b,d)})},mousedown:function(b,c){var d=this.$saturation.offset();return this.data.startY=c.pageY,this.data.startX=c.pageX,this.data.top=c.pageY-d.top,this.data.left=c.pageX-d.left,this.data.cach={},this.move(b,this.data.left,this.data.top),this.mousemove=function(a){var c=this.data.left+(a.pageX||this.data.startX)-this.data.startX,d=this.data.top+(a.pageY||this.data.startY)-this.data.startY;return this.move(b,c,d),!1},this.mouseup=function(){return a(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),this.data.left=this.data.cach.left,this.data.top=this.data.cach.top,!1},a(document).on({mousemove:a.proxy(this.mousemove,this),mouseup:a.proxy(this.mouseup,this)}),!1},move:function(a,b,c,d){c=Math.max(0,Math.min(this.height,c)),b=Math.max(0,Math.min(this.width,b)),void 0===this.data.cach&&(this.data.cach={}),this.data.cach.left=b,this.data.cach.top=c,this.$handle.css({top:c-this.size,left:b-this.size}),d!==!1&&a.update({s:b/this.width,v:1-c/this.height},"saturation")},update:function(b){void 0===b.color.value.h&&(b.color.value.h=0),this.$saturation.css("backgroundColor",a.asColor.HSLToHEX({h:b.color.value.h,s:1,l:.5}));var c=b.color.value.s*this.width,d=(1-b.color.value.v)*this.height;this.move(b,c,d,!1)},moveLeft:function(a){var b=this.step.left,c=this.data;c.left=Math.max(0,Math.min(this.width,c.left-b)),this.move(a,c.left,c.top)},moveRight:function(a){var b=this.step.left,c=this.data;c.left=Math.max(0,Math.min(this.width,c.left+b)),this.move(a,c.left,c.top)},moveUp:function(a){var b=this.step.top,c=this.data;c.top=Math.max(0,Math.min(this.width,c.top-b)),this.move(a,c.left,c.top)},moveDown:function(a){var b=this.step.top,c=this.data;c.top=Math.max(0,Math.min(this.width,c.top+b)),this.move(a,c.left,c.top)},keyboard:function(b){var c,d=this;return b._keyboard?(c=a.extend(!0,{},b._keyboard),void this.$saturation.attr("tabindex","0").on("focus",function(){return c.attach({left:function(){d.moveLeft.call(d,b)},right:function(){d.moveRight.call(d,b)},up:function(){d.moveUp.call(d,b)},down:function(){d.moveDown.call(d,b)}}),!1}).on("blur",function(){c.detach()})):!1},destroy:function(){a(document).off({mousemove:this.mousemove,mouseup:this.mouseup})}})}(jQuery),function(a){a.asColorInput.registerComponent("gradient",{degree:1,count:0,markers:[],current:null,defaults:{gradientText:"Gradient",cancelText:"Cancel",keepMode:!1},init:function(b,c){var d=this;this.options=a.extend(this.defaults,c);var e='<div class="'+b.namespace+'-gradient-controll"><a href="#" class="'+b.namespace+'-gradient-trigger">'+this.options.gradientText+'</a><a href="#" class="'+b.namespace+'-gradient-cancel">'+this.options.cancelText+'</a></div><div class="'+b.namespace+'-gradient"><div class="'+b.namespace+'-gradient-panel"><div class="'+b.namespace+'-gradient-markers"></div></div><div class="'+b.namespace+'-gradient-wheel"><i></i></div><input class="'+b.namespace+'-gradient-degree" type="text" value="360" size="3" /></div>';this.api=b,this.classes={enable:b.namespace+"-gradient_enable",marker:b.namespace+"-gradient-marker",active:b.namespace+"-gradient-marker_active"},this.isOpened=!1,this.initialized=!1,this.$doc=a(document),this.$template=a(e).appendTo(b.$dropdown),this.$controll=d.$template.eq(0),this.$trigger=this.$controll.find("."+b.namespace+"-gradient-trigger"),this.$cancel=this.$controll.find("."+b.namespace+"-gradient-cancel"),this.$gradient=this.$template.eq(1),this.$panel=this.$gradient.find("."+b.namespace+"-gradient-panel"),this.$markers=this.$gradient.find("."+b.namespace+"-gradient-markers"),this.$wheel=this.$gradient.find("."+b.namespace+"-gradient-wheel"),this.$pointer=this.$wheel.find("i"),this.$degree=this.$gradient.find("."+b.namespace+"-gradient-degree"),this.g_input.init(this),this.g_controll.init(this),this.g_panel.init(this),this.g_wheel.init(this),this.g_degree.init(this),b.$element.on("asColorInput::ready",function(a,b){"gradient"===b.options.mode&&(null!=(matched=d.g_input.gradient.match.exec(d.api.gradient))&&(d.keepGradient(d),d.g_input.gradient.parse(matched,d)),d.options.keepMode&&d.keepGradient(d))})},keepGradient:function(a){a.width=a.$markers.width(),a.isOpened=!0,a.$gradient.addClass(a.classes.enable),a.api.isGradient=!0,a.g_controll.makeGradient(a),a.api.position()},g_input:{init:function(a){this.bind(a)},bind:function(a){var b=this;a.api.$element.on("keyup",function(c){a.api.isGradient&&(27===c.keyCode?a.api.close():13===c.keyCode&&null!=(matched=b.gradient.match.exec(a.api.$element.val()))&&(b.gradient.parse(matched,a),a.api.update({},"input"),a.api.$element.focus()))})},gradient:{match:/gradient\(\s*(\d{1,3})deg\s*,((\s*\S*)+)\)/,parse:function(a,b){var c,d=/(#([^\s]+)|rgb\([^\)]+\)|rgba\([^\)]+\))\s*(\d{1,3}%)/g,e=a[1],f=a[2].match(d);b.$markers.children().remove(),b.markers=[],b.count=0,b.g_wheel.setDegree(e,b);for(var g in f)b.api.color.from(f[g]),c=parseInt(f[g].match(/[^\,\(]\)*\s+(\d{1,3})%/)[1]),b.g_panel.makeMarker(b.api.color,c,b),b.api.set(b.api.color)}}},g_controll:{init:function(a){var b=this;this.bind(a),a.api.$element.on("asColorInput::close",function(){return a.api.isGradient&&b.setGradient(a),!1})},bind:function(a){var b=this,c=a.api;a.$trigger.on("click",function(){return a.options.keepMode?!1:(a.isOpened?(a.$gradient.removeClass(a.classes.enable),b.setGradient(a),c.isGradient=!1,c.set(c.originalColor)):(a.width=a.$markers.width(),a.$gradient.addClass(a.classes.enable),c.isGradient=!0,b.makeGradient(a),c.$element.focus()),c.position(),a.isOpened=!a.isOpened,!1)}),a.$cancel.on("click",function(){return c.color.from("#000"),c.update({}),a.count=0,b.retrieve(a),!1})},setGradient:function(a){var b=this;this.origin={},this.origin.markers=[],a.markers.map(function(a){var c={color:a.color,percent:a.percent};b.origin.markers.push(c)}),this.origin.degree=a.degree},makeGradient:function(a){var b=a.markers,c=a.api,d="gradient("+(a.degree?a.degree:0)+"deg,",e="",f="",g=this.getPrefix();return b.sort(function(a,b){return a.percent>b.percent}),b.map(function(a,b,c){d+=a.color+" "+a.percent+"%,",b===c.length-1?(e+="color-stop("+a.percent/100+","+a.color+")",f+=a.color+" "+a.percent+"%"):(e+="color-stop("+a.percent/100+","+a.color+"),",f+=a.color+" "+a.percent+"%,")}),d=d.substring(0,d.length-1),d+=")",c.gradient=g+"linear-"+d,c._trigger("gradientChange",d),c.$element.val(d),"-webkit-"===g&&(a.$panel[0].style.backgroundImage=g+"gradient(linear, left top, right top, "+e+")"),a.$panel[0].style.backgroundImage=g+"linear-gradient(left, "+f+")",c.components.trigger.update(c),d},retrieve:function(a){a.markers.map(function(a){a.$element.blur(),a.$element.remove()}),a.markers=[],a.g_panel.makeMarker("#fff",0,a),a.g_panel.makeMarker("#000",100,a),a.g_wheel.setDegree(0,a),this.makeGradient(a)},getPrefix:function(){var a=window.navigator.userAgent,b="";return/MSIE/g.test(a)?b="-ms-":/Firefox/g.test(a)?b="-moz-":/(WebKit)/i.test(a)?b="-webkit-":/Opera/g.test(a)&&(b="-o-"),b}},g_panel:{init:function(a){this.makeMarker("#fff",0,a),this.makeMarker("#000",100,a),this.bind(a),a.api.$element.on("asColorInput::change",function(b,c){a.current&&a.api.isGradient&&!a.api.clear?(0===c.color.value.a&&(c.color.value.a=1),a.current.setColor(c.color.toRGBA()),a.g_controll.makeGradient(a),a.api._trigger("apply")):a.api.clear&&(a.count=0,a.g_controll.retrieve(a),a.api.gradient="")})},bind:function(a){var b=this;a.$markers.on("mousedown.asColorInput",function(c){var d=c.which?3===c.which:2===c.button;if(d)return!1;var e=c.pageX-a.$markers.offset().left,f=Math.round(e/a.width*100);return b.makeMarker("#fff",f,a),a.g_controll.makeGradient(a),!1})},makeMarker:function(b,c,d){var e=this,f=d.$doc,g=function(){this.color=b,this.percent=c,this._id=++d.count,this.$element=a('<span class="'+d.classes.marker+'"><i></i></span>').attr("tabindex",0).data("id",this._id),this.$element.appendTo(d.$markers),this.$element.on("mousedown.asColorInput",function(a){var b=a.which?3===a.which:2===a.button;return b?!1:(e.mousedown(a,this,d),!1)})};g.prototype.setColor=function(a){this.color=a,this.$element.find("i").css({background:a})},g.prototype.setPercent=function(a){this.percent=a,this.$element.css({left:a+"%"})};var h=new g;return h.setPercent(c),h.setColor(b),d.markers.push(h),null!==d.current&&(d.api.originalColor=d.current.color,d.api._trigger("apply")),d.$markers.children().removeClass(d.classes.active),d.current=h,h.$element.addClass(d.classes.active).focus(),h.hasBinded=!1,h.$element.on("focus",function(){h.hasBinded||(f.on("keydown."+h._id,function(a){var b=a.keyCode||a.which;if(46===b){if(d.count<=2)return;e.del(h,d),d.g_controll.makeGradient(d),d.$markers.children().eq(d.count-1).addClass(d.classes.active).focus()}}),h.hasBinded=!0)}).on("blur",function(){f.off("keydown."+h._id),h.hasBinded=!1}),h},mousedown:function(b,c,d){var e,f=this,g=d.api,h=a(c).data("id");a.each(d.markers,function(a,b){b._id===h&&(e=b)}),d.current!==e&&(g.originalColor=d.current.color,d.current.$element.removeClass(d.classes.active),d.current=e,e.$element.addClass(d.classes.active));var i,j=a(c).position().left,k=b.pageX;return g.set(e.color),this.mousemove=function(a){i=a.pageX||k;var b=j+i-k;return f.move(e,b,d),!1},this.mouseup=function(){return a(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),!1},a(document).on({mousemove:a.proxy(this.mousemove,this),mouseup:a.proxy(this.mouseup,this)}),a(c).focus(),!1},move:function(a,b,c){b=Math.max(0,Math.min(c.width,b));var d=Math.round(b/c.width*100);a.setPercent(d),c.g_controll.makeGradient(c)},del:function(a,b){b.count-=1,a.$element.blur(),a.$element.remove(),b.markers.splice(b.markers.indexOf(a),1)}},g_wheel:{init:function(a){var b=this;this.bind(a),setTimeout(function(){b.setDegree(0,a),a.initialized=!0},0)},bind:function(a){var b=this;a.$wheel.on("mousedown.asColorInput",function(c){var d=c.which?3===c.which:2===c.button;return d?!1:(b.mousedown(c,a),!1)})},mousedown:function(b,c){var d=c.$wheel.offset(),e=c.$wheel.width()/2,f=d.left+e,g=d.top+e,h=c.$doc,i=this;this.r=e,this.wheelMove=function(a){var b=a.pageX-f,d=g-a.pageY,h=i.getPosition(b,d),j=i.calDegree(h.x,h.y);i._setDegree(j,c);var k=i.calPointer(j,e);c.$pointer.css({left:k.x,top:k.y})},this.wheelMouseup=function(){return h.off({mousemove:this.wheelMove,mouseup:this.wheelMouseup}),!1},h.on({mousemove:a.proxy(this.wheelMove,this),mouseup:a.proxy(this.wheelMouseup,this)}),this.wheelMove(b)},getPosition:function(a,b){var c=this.r,d=a/Math.sqrt(a*a+b*b)*c,e=b/Math.sqrt(a*a+b*b)*c;return{x:d,y:e}},calDegree:function(a,b){var c=Math.round(Math.atan(Math.abs(b/a))*(180/Math.PI));return 0>=a&&b>0?180-c:0>=a&&0>=b?c+180:a>0&&0>=b?360-c:a>0&&b>0?c:void 0},_setDegree:function(a,b){b.degree=a,b.$degree.val(a),b.initialized&&b.g_controll.makeGradient(b)},setDegree:function(a,b){if(b.degree===a)return!1;var c=this.r||b.$wheel.width()/2,d=this.calPointer(a,c);b.$pointer.css({left:d.x,top:d.y}),this._setDegree(a,b)},calPointer:function(a,b){var c=Math.cos(a*Math.PI/180)*b,d=Math.sin(a*Math.PI/180)*b;return{x:b+c,y:b-d}}},g_degree:{init:function(a){this.bind(a)},bind:function(b){b.$degree.on("blur.asColorInput",function(){var a=parseInt(this.value,10);return b.g_wheel.setDegree(a,b),!1}).on("keydown.asColorInput",function(b){var c=b.keyCode||b.which;return 13===c?(a(this).blur(),!1):void 0})}},destory:function(){this.$element.off("click"),this.$element.remove()}})}(jQuery);