/*! asColorInput - v0.1.3 - 2014-06-25
* https://github.com/amazingSurge/jquery-asColorInput
* Copyright (c) 2014 amazingSurge; Licensed GPL */
!function(a,b,c,d,e){"use strict";function f(a){a.id=g,g++}var g=0,h=(!!/msie/i.exec(a.navigator.userAgent),c.asColorInput=function(a,b){this.element=a,this.$element=c(a),this.opened=!1,this.firstOpen=!0,this.disabled=!1,this.clear=!1,f(this),this.options=c.extend(!0,{},h.defaults,b,this.$element.data()),this.namespace=this.options.namespace,this.classes={wrap:this.namespace+"-wrap",dropdown:this.namespace+"-dropdown",input:this.namespace+"-input",clear:this.namespace+"-clear",skin:this.namespace+"_"+this.options.skin,open:this.namespace+"_open",mask:this.namespace+"-mask",hideInput:this.namespace+"_hideInput",disabled:this.namespace+"_disabled",mode:this.namespace+"-mode_"+this.options.mode},this.components=c.extend(!0,{},this.components),this._comps=h.modes[this.options.mode],""===this.element.value?this.color=new d({r:255,g:255,b:255,a:1},this.options.format):("gradient"===this.options.mode&&(this.gradient=this.element.value),this.color=new d(this.element.value,this.options.format)),this.options.hideInput&&this.$element.addClass(this.classes.hideInput),this.updateInput(),this.originalColor=this.color.toRGBA(),this._trigger("init"),this.init()});h.prototype={constructor:h,components:{},init:function(){var a=this;this.$dropdown=c('<div class="'+this.classes.dropdown+'" data-mode="'+this.options.mode+'"></div>'),this.$element.wrap('<div class="'+this.classes.wrap+'"></div>').addClass(this.classes.input),this.$clear=c('<a href="#" class="'+this.classes.clear+'">x</a>').insertAfter(this.$element),this.$wrap=this.$element.parent(),this.$body=c("body"),this.$dropdown.data("asColorInput",this),this.options.skin&&(this.$dropdown.addClass(this.classes.skin),this.$element.parent().addClass(this.classes.skin)),this.create(),this.options.readonly&&this.$element.prop("readonly",!0),this.$element.on({"click.asColorInput":function(){return a.opened||a.open(),!1},"keydown.asColorInput":function(b){a.isGradient||(9===b.keyCode?a.close():13===b.keyCode&&(a.color.from(a.$element.val()),a.update({},"input"),a.close()))},"keyup.asColorInput":function(){a.isGradient||(a.color.from(a.$element.val()),a.update({},"input"))}}),this.$clear.on("click",function(){return a.clear=!0,a.color.from("transparent"),a.update({}),a.$element.val(""),a.clear=!1,!1}),this._trigger("ready")},create:function(){var a=this;this.components.trigger.init(this),c.each(this._comps,function(b,d){d===!0&&(d={}),a.options.components[b]!==e&&(d=c.extend(d,a.options.components[b])),a.components[b]&&a.components[b].init(a,d)}),this._trigger("create")},_trigger:function(a){this.$element.trigger("asColorInput::"+a,this),this.$element.trigger(a+".asColorInput",this),a=a.replace(/\b\w+\b/g,function(a){return a.substring(0,1).toUpperCase()+a.substring(1)});var b="on"+a,c=arguments.length>1?Array.prototype.slice.call(arguments,1):e;"function"==typeof this.options[b]&&this.options[b].apply(this,c)},update:function(a,b){var d=this;a!=={}&&d.color.set(a),this._trigger("change",a),c.each(this._comps,function(a){b!==a&&d.components[a]&&d.components[a].update&&d.components[a].update(d)}),this.components.trigger.update(this),"input"!==b&&(this.isGradient||this.updateInput())},updateInput:function(){var a=this.options.format;if(a){if(this.options.reduceAlpha&&1===this.color.value.a)switch(a){case"rgba":a="rgb";break;case"hsla":a="hsl"}this.$element.val(this.get(a))}else this.$element.val(this.color.toString())},opacity:function(a){return a?void this.update({a:a}):this.color.value.a},position:function(){var b,d,e=!this.$element.is(":visible"),f=e?this.$trigger.offset():this.$element.offset(),g=e?this.$trigger.outerHeight():this.$element.outerHeight(),h=e?this.$trigger.outerWidth():this.$element.outerWidth()+this.$trigger.outerWidth(),i=this.$dropdown.outerWidth(!0),j=this.$dropdown.outerHeight(!0);b=j+f.top>c(a).height()+c(a).scrollTop()?f.top-j:f.top+g,d=i+f.left>c(a).width()+c(a).scrollLeft()?f.left-i+h:f.left,this.$dropdown.css({position:"absolute",top:b,left:d})},open:function(){if(!this.disabled){var b=this;this.$dropdown[0]!==this.$body.children().last()[0]&&this.$dropdown.detach().appendTo(this.$body),this.$mask=c("."+b.classes.mask),0==this.$mask.length&&this.createMask(),this.$dropdown.prev()[0]!==this.$mask[0]&&this.$dropdown.before(this.$mask),c("#asColorInput-dropdown").removeAttr("id"),this.$dropdown.attr("id","asColorInput-dropdown"),this.$mask.show(),this.position(),c(a).on("resize.asColorInput",c.proxy(this.position,this)),this.$dropdown.addClass(this.classes.open),this.opened=!0,this.firstOpen&&(this.firstOpen=!1,this._trigger("firstOpen")),this._trigger("open")}},createMask:function(){this.$mask=c(b.createElement("div")),this.$mask.attr("class",this.classes.mask),this.$mask.hide(),this.$mask.appendTo(this.$body);this.$mask.on("mousedown touchstart click",function(a){var b,d=c("#asColorInput-dropdown");d.length>0&&(b=d.data("asColorInput"),b.opened&&(b.options.hideFireChange?b.apply():b.cancel()),a.preventDefault(),a.stopPropagation())})},close:function(){this.opened=!1,this.$element.blur(),this.$mask.hide(),this.$dropdown.removeClass(this.classes.open),c(a).off("resize.asColorInput"),this._trigger("close")},clear:function(){this.color.from("#fff"),this.update({}),this.close()},cancel:function(){return this.color.from(this.originalColor),this.update({}),this.close(),!1},apply:function(){return this.originalColor=this.color.toRGBA(),this.close(),this._trigger("apply"),!1},set:function(a){return this.color.from(a),this.update(),this},get:function(a){return a===e?this.color.toString():"rgb"===a?this.color.toRGB():"rgba"===a?this.color.toRGBA():"hsl"===a?this.color.toHSL():"hsla"===a?this.color.toHSLA():"hex"===a?this.color.toHEX():void 0},enable:function(){return this.disabled=!1,this.$parent.addClass(this.classes.disabled),this},disable:function(){return this.disabled=!0,this.$parent.removeClass(this.classes.disabled),this},destroy:function(){}},h.registerComponent=function(a,b){h.prototype.components[a]=b},h.localization=[],h.defaults={namespace:"asColorInput",readonly:!1,skin:null,hideInput:!1,hideFireChange:!0,keyboard:!1,format:"rgba",reduceAlpha:!0,mode:"simple",components:{},onInit:null,onReady:null,onChange:null,onClose:null,onOpen:null,onApply:null},h.modes={simple:{saturation:!0,hue:!0,alpha:!0},palettes:{palettes:!0},complex:{preview:!0,palettes:!0,saturation:!0,hue:!0,alpha:!0,hex:!0,buttons:!0},gradient:{preview:!0,palettes:!0,saturation:!0,hue:!0,alpha:!0,hex:!0,gradient:!0}},h.registerComponent("trigger",{template:'<div class="asColorInput-trigger"><span></span></div>',init:function(a){var b='<div class="'+a.namespace+'-trigger"><span></span></div>';a.$trigger=c(b),this.$trigger_inner=a.$trigger.children("span"),a.$trigger.insertAfter(a.$element),a.$trigger.on("click",function(){return a.opened?a.close():a.open(),!1}),this.update(a)},update:function(a){a.isGradient?(this.$trigger_inner.css("backgroundColor","transparent"),this.$trigger_inner[0].style.backgroundImage=a.gradient):(this.$trigger_inner[0].style.backgroundImage="",this.$trigger_inner.css("backgroundColor",a.color.toRGBA()))},destroy:function(a){a.$trigger.remove()}}),c.fn.asColorInput=function(a){if("string"==typeof a){var b=a,d=arguments.length>1?Array.prototype.slice.call(arguments,1):e;return this.each(function(){var a=c.data(this,"asColorInput");"function"==typeof a[b]&&a[b].apply(a,d)})}return this.each(function(){c.data(this,"asColorInput")||c.data(this,"asColorInput",new h(this,a))})}}(window,document,jQuery,function(a){return void 0===a.asColor?!1:a.asColor}(jQuery));